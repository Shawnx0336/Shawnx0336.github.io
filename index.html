<!DOCTYPE html>

<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Stop the Boost anxiety. Coordinate your monthly Chime SpotMe Boosts with trusted groups. Set it once, forget it forever.">
  <meta property="og:title" content="BoostCircle - Coordinate Your Monthly Boosts">
  <meta property="og:description" content="Form trusted circles of 4-10 people who reliably exchange Chime Boosts every month. Auto-pairing, dual confirmation, reputation tracking.">
  <meta property="og:type" content="website">
  <title>BoostCircle v2.0 - Coordinate Your Monthly Boosts</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
  <style>
    /* ============================================
       RESET & BASE STYLES
       ============================================ */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

:root {
  --bg-primary: #0a0a0a;
  --bg-secondary: #141414;
  --bg-tertiary: #1e1e1e;
  --bg-elevated: #252525;
  --text-primary: #ffffff;
  --text-secondary: #a0a0a0;
  --text-muted: #666666;
  --accent-blue: #2563eb;
  --accent-blue-hover: #1d4ed8;
  --accent-green: #10b981;
  --accent-green-hover: #059669;
  --accent-yellow: #f59e0b;
  --accent-yellow-hover: #d97706;
  --accent-red: #ef4444;
  --accent-red-hover: #dc2626;
  --border-color: rgba(255,255,255,0.08);
  --border-hover: rgba(255,255,255,0.15);
  --shadow-sm: 0 2px 8px rgba(0,0,0,0.4);
  --shadow-md: 0 4px 16px rgba(0,0,0,0.5);
  --shadow-lg: 0 8px 32px rgba(0,0,0,0.6);
}

body {
  font-family: 'Outfit', -apple-system, BlinkMacSystemFont, sans-serif;
  background: var(--bg-primary);
  color: var(--text-primary);
  font-size: 15px;
  line-height: 1.6;
  min-height: 100vh;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* ============================================
   LAYOUT
   ============================================ */
.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 20px;
}

.header {
  background: var(--bg-secondary);
  border-bottom: 1px solid var(--border-color);
  padding: 16px 0;
  position: sticky;
  top: 0;
  z-index: 100;
  backdrop-filter: blur(10px);
  background: rgba(20, 20, 20, 0.95);
}

.header-content {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 20px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.logo {
  font-size: 22px;
  font-weight: 800;
  background: linear-gradient(135deg, var(--accent-blue), var(--accent-green));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  letter-spacing: -0.5px;
  cursor: pointer;
  transition: transform 0.2s;
}

.logo:hover {
  transform: scale(1.02);
}

.header-actions {
  display: flex;
  gap: 16px;
  align-items: center;
}

.avatar {
  width: 42px;
  height: 42px;
  border-radius: 50%;
  background: linear-gradient(135deg, var(--accent-blue), var(--accent-green));
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.2s;
  font-size: 14px;
  box-shadow: var(--shadow-sm);
}

.avatar:hover {
  transform: scale(1.08);
  box-shadow: var(--shadow-md);
}

.notification-btn {
  position: relative;
  background: var(--bg-elevated);
  border: 1px solid var(--border-color);
  border-radius: 50%;
  width: 42px;
  height: 42px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.2s;
  font-size: 20px;
}

.notification-btn:hover {
  background: var(--bg-tertiary);
  border-color: var(--border-hover);
  transform: scale(1.05);
}

.notification-badge {
  position: absolute;
  top: -4px;
  right: -4px;
  background: var(--accent-red);
  color: white;
  border-radius: 12px;
  padding: 2px 6px;
  font-size: 11px;
  font-weight: 700;
  min-width: 20px;
  text-align: center;
  box-shadow: var(--shadow-sm);
}

.legal-sticky {
  position: sticky;
  top: 60px;
  z-index: 99;
  background: var(--accent-yellow);
  color: #000;
  padding: 12px 20px;
  text-align: center;
  font-weight: 600;
  font-size: 13px;
  box-shadow: var(--shadow-md);
  animation: slideDown 0.3s ease-out;
}

@keyframes slideDown {
  from { transform: translateY(-100%); }
  to { transform: translateY(0); }
}

/* ============================================
   CARDS
   ============================================ */
.card {
  background: var(--bg-secondary);
  border-radius: 16px;
  padding: 28px;
  border: 1px solid var(--border-color);
  margin-bottom: 24px;
  transition: all 0.3s;
  box-shadow: var(--shadow-sm);
}

.card:hover {
  box-shadow: var(--shadow-md);
  border-color: var(--border-hover);
}

.card-title {
  font-size: 20px;
  font-weight: 700;
  margin-bottom: 20px;
  letter-spacing: -0.3px;
}

.card-subtitle {
  font-size: 14px;
  color: var(--text-secondary);
  margin-bottom: 12px;
}

/* ============================================
   BUTTONS
   ============================================ */
.btn {
  padding: 12px 24px;
  border-radius: 10px;
  border: none;
  font-weight: 600;
  cursor: pointer;
  font-size: 14px;
  transition: all 0.2s;
  display: inline-block;
  text-align: center;
  font-family: 'Outfit', sans-serif;
  letter-spacing: -0.2px;
  position: relative;
  overflow: hidden;
}

.btn::before {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: 0;
  height: 0;
  border-radius: 50%;
  background: rgba(255,255,255,0.1);
  transform: translate(-50%, -50%);
  transition: width 0.6s, height 0.6s;
}

.btn:active::before {
  width: 300px;
  height: 300px;
}

.btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.btn-primary {
  background: var(--accent-blue);
  color: white;
  box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
}

.btn-primary:hover:not(:disabled) {
  background: var(--accent-blue-hover);
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(37, 99, 235, 0.4);
}

.btn-secondary {
  background: var(--bg-elevated);
  border: 1px solid var(--border-color);
  color: var(--text-primary);
}

.btn-secondary:hover:not(:disabled) {
  background: var(--bg-tertiary);
  border-color: var(--border-hover);
  transform: translateY(-2px);
}

.btn-danger {
  background: var(--accent-red);
  color: white;
  box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
}

.btn-danger:hover:not(:disabled) {
  background: var(--accent-red-hover);
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(239, 68, 68, 0.4);
}

.btn-success {
  background: var(--accent-green);
  color: white;
  box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
}

.btn-success:hover:not(:disabled) {
  background: var(--accent-green-hover);
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
}

.btn-block {
  width: 100%;
  display: block;
}

/* ============================================
   FORMS
   ============================================ */
.form-group {
  margin-bottom: 20px;
}

.form-label {
  display: block;
  margin-bottom: 8px;
  font-weight: 600;
  font-size: 14px;
}

.form-input, .form-select {
  width: 100%;
  padding: 14px 16px;
  background: var(--bg-tertiary);
  border: 1px solid var(--border-color);
  border-radius: 10px;
  color: var(--text-primary);
  font-size: 14px;
  font-family: 'Outfit', sans-serif;
  transition: all 0.2s;
}

.form-input:focus, .form-select:focus {
  outline: none;
  border-color: var(--accent-blue);
  background: var(--bg-elevated);
  box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
}

.form-error {
  color: var(--accent-red);
  font-size: 12px;
  margin-top: 6px;
  display: flex;
  align-items: center;
  gap: 4px;
}

.form-help {
  color: var(--text-secondary);
  font-size: 12px;
  margin-top: 6px;
}

.radio-group {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
  gap: 12px;
}

.radio-option {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 12px;
  background: var(--bg-tertiary);
  border: 1px solid var(--border-color);
  border-radius: 10px;
  cursor: pointer;
  transition: all 0.2s;
}

.radio-option:hover {
  background: var(--bg-elevated);
  border-color: var(--border-hover);
}

.radio-option input {
  cursor: pointer;
}

.checkbox-group {
  display: flex;
  align-items: flex-start;
  gap: 10px;
  margin-bottom: 16px;
  padding: 14px;
  background: var(--bg-tertiary);
  border-radius: 10px;
  border: 1px solid var(--border-color);
  transition: all 0.2s;
}

.checkbox-group:hover {
  background: var(--bg-elevated);
  border-color: var(--border-hover);
}

.checkbox-group input {
  margin-top: 2px;
  cursor: pointer;
  width: 18px;
  height: 18px;
}

.checkbox-group label {
  cursor: pointer;
  font-size: 14px;
  flex: 1;
}

/* ============================================
   MODAL SYSTEM
   ============================================ */
.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0,0,0,0.85);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  padding: 20px;
  backdrop-filter: blur(4px);
  animation: fadeIn 0.2s ease-out;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

.modal-overlay.active {
  display: flex;
}

.modal {
  background: var(--bg-secondary);
  border-radius: 20px;
  max-width: 520px;
  width: 100%;
  max-height: 90vh;
  overflow-y: auto;
  padding: 36px;
  position: relative;
  box-shadow: var(--shadow-lg);
  border: 1px solid var(--border-color);
  animation: modalSlideUp 0.3s ease-out;
}

@keyframes modalSlideUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.modal-close {
  position: absolute;
  top: 20px;
  right: 20px;
  background: var(--bg-elevated);
  border: 1px solid var(--border-color);
  color: var(--text-secondary);
  font-size: 24px;
  cursor: pointer;
  width: 36px;
  height: 36px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
  transition: all 0.2s;
}

.modal-close:hover {
  background: var(--bg-tertiary);
  color: var(--text-primary);
  transform: rotate(90deg);
}

.modal-title {
  font-size: 26px;
  font-weight: 800;
  margin-bottom: 8px;
  letter-spacing: -0.5px;
}

.modal-subtitle {
  color: var(--text-secondary);
  margin-bottom: 28px;
  font-size: 14px;
}

.modal-steps {
  display: flex;
  gap: 8px;
  margin-bottom: 28px;
}

.modal-step {
  flex: 1;
  height: 4px;
  background: var(--bg-tertiary);
  border-radius: 2px;
  transition: all 0.3s;
}

.modal-step.active {
  background: var(--accent-blue);
}

.modal-step.completed {
  background: var(--accent-green);
}

/* ============================================
   TOAST NOTIFICATIONS
   ============================================ */
.toast {
  position: fixed;
  bottom: 24px;
  right: 24px;
  background: var(--bg-secondary);
  border: 1px solid var(--border-color);
  border-radius: 12px;
  padding: 16px 20px;
  display: flex;
  gap: 12px;
  align-items: flex-start;
  max-width: 400px;
  box-shadow: var(--shadow-lg);
  opacity: 0;
  transform: translateX(400px);
  transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
  z-index: 10001;
}

.toast.show {
  opacity: 1;
  transform: translateX(0);
}

.toast-icon {
  font-size: 24px;
  flex-shrink: 0;
}

.toast-content {
  flex: 1;
}

.toast-title {
  font-weight: 700;
  margin-bottom: 4px;
  font-size: 14px;
}

.toast-message {
  color: var(--text-secondary);
  font-size: 13px;
}

.toast-error {
  border-left: 4px solid var(--accent-red);
}

.toast-success {
  border-left: 4px solid var(--accent-green);
}

.toast-warning {
  border-left: 4px solid var(--accent-yellow);
}

.toast-info {
  border-left: 4px solid var(--accent-blue);
}

/* ============================================
   LOADING STATES
   ============================================ */
.global-loader {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.9);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 10000;
  backdrop-filter: blur(4px);
}

.loader-content {
  text-align: center;
}

.spinner {
  width: 56px;
  height: 56px;
  border: 4px solid rgba(255, 255, 255, 0.1);
  border-top-color: var(--accent-blue);
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
  margin: 0 auto 20px;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

.loader-message {
  color: white;
  font-weight: 600;
  font-size: 15px;
}

.skeleton {
  background: linear-gradient(90deg, var(--bg-tertiary) 25%, var(--bg-elevated) 50%, var(--bg-tertiary) 75%);
  background-size: 200% 100%;
  animation: loading 1.5s ease-in-out infinite;
  border-radius: 8px;
}

@keyframes loading {
  0% { background-position: 200% 0; }
  100% { background-position: -200% 0; }
}

/* ============================================
   BADGES & STATUS
   ============================================ */
.badge {
  display: inline-flex;
  align-items: center;
  padding: 6px 14px;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 700;
  letter-spacing: 0.3px;
}

.badge-green {
  background: rgba(16, 185, 129, 0.15);
  color: var(--accent-green);
  border: 1px solid rgba(16, 185, 129, 0.3);
}

.badge-blue {
  background: rgba(37, 99, 235, 0.15);
  color: var(--accent-blue);
  border: 1px solid rgba(37, 99, 235, 0.3);
}

.badge-yellow {
  background: rgba(245, 158, 11, 0.15);
  color: var(--accent-yellow);
  border: 1px solid rgba(245, 158, 11, 0.3);
}

.badge-red {
  background: rgba(239, 68, 68, 0.15);
  color: var(--accent-red);
  border: 1px solid rgba(239, 68, 68, 0.3);
}

/* ============================================
   PROGRESS BAR
   ============================================ */
.progress-bar {
  height: 10px;
  background: var(--bg-tertiary);
  border-radius: 10px;
  overflow: hidden;
  margin-top: 12px;
  box-shadow: inset 0 2px 4px rgba(0,0,0,0.3);
}

.progress-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--accent-blue), var(--accent-green));
  transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 0 10px rgba(37, 99, 235, 0.5);
}

/* ============================================
   REPUTATION DISPLAY
   ============================================ */
.reputation-score {
  text-align: center;
  padding: 32px 24px;
}

.reputation-number {
  font-size: 64px;
  font-weight: 800;
  margin-bottom: 12px;
  letter-spacing: -2px;
  background: linear-gradient(135deg, var(--accent-green), var(--accent-blue));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.reputation-number.excellent {
  background: linear-gradient(135deg, #10b981, #059669);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

.reputation-number.good {
  background: linear-gradient(135deg, #2563eb, #1d4ed8);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

.reputation-number.fair {
  background: linear-gradient(135deg, #f59e0b, #d97706);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

.reputation-number.poor {
  background: linear-gradient(135deg, #ef4444, #dc2626);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

/* ============================================
   GROUP & MEMBER LISTS
   ============================================ */
.group-list {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.group-item {
  background: var(--bg-tertiary);
  padding: 20px;
  border-radius: 12px;
  cursor: pointer;
  transition: all 0.2s;
  border: 1px solid var(--border-color);
}

.group-item:hover {
  background: var(--bg-elevated);
  border-color: var(--accent-blue);
  transform: translateX(4px);
  box-shadow: var(--shadow-sm);
}

.group-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 10px;
}

.group-name {
  font-weight: 700;
  font-size: 17px;
  letter-spacing: -0.3px;
}

.group-meta {
  color: var(--text-secondary);
  font-size: 13px;
}

.member-list {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.member-item {
  display: flex;
  align-items: center;
  gap: 14px;
  padding: 16px;
  background: var(--bg-tertiary);
  border-radius: 12px;
  border: 1px solid var(--border-color);
  transition: all 0.2s;
}

.member-item:hover {
  background: var(--bg-elevated);
  border-color: var(--border-hover);
}

.member-avatar {
  width: 48px;
  height: 48px;
  border-radius: 50%;
  background: linear-gradient(135deg, var(--accent-blue), var(--accent-green));
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 700;
  font-size: 16px;
  flex-shrink: 0;
  box-shadow: var(--shadow-sm);
}

.member-info {
  flex: 1;
}

.member-name {
  font-weight: 600;
  margin-bottom: 4px;
  font-size: 15px;
}

.member-meta {
  display: flex;
  align-items: center;
  gap: 8px;
  flex-wrap: wrap;
}

/* ============================================
   COMMITMENT LIST
   ============================================ */
.commitment-list {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.commitment-item {
  display: flex;
  align-items: center;
  gap: 14px;
  padding: 16px;
  background: var(--bg-tertiary);
  border-radius: 12px;
  cursor: pointer;
  transition: all 0.2s;
  border: 1px solid var(--border-color);
}

.commitment-item:hover {
  background: var(--bg-elevated);
  border-color: var(--border-hover);
  transform: translateX(2px);
}

.commitment-status {
  font-size: 24px;
  flex-shrink: 0;
}

.commitment-info {
  flex: 1;
}

.commitment-sign {
  font-weight: 600;
  font-size: 15px;
  margin-bottom: 4px;
  font-family: 'JetBrains Mono', monospace;
}

.commitment-meta {
  color: var(--text-secondary);
  font-size: 12px;
}

/* ============================================
   LANDING PAGE
   ============================================ */
.landing {
  text-align: center;
  padding: 80px 20px 60px;
  max-width: 1000px;
  margin: 0 auto;
}

.landing-title {
  font-size: 64px;
  font-weight: 800;
  margin-bottom: 20px;
  letter-spacing: -2px;
  background: linear-gradient(135deg, var(--text-primary), var(--text-secondary));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  line-height: 1.1;
}

.landing-subtitle {
  font-size: 22px;
  color: var(--text-secondary);
  margin-bottom: 40px;
  max-width: 700px;
  margin-left: auto;
  margin-right: auto;
  line-height: 1.5;
}

.landing-cta {
  display: flex;
  gap: 16px;
  justify-content: center;
  margin-bottom: 80px;
  flex-wrap: wrap;
}

.landing-cta .btn {
  padding: 16px 48px;
  font-size: 16px;
  font-weight: 700;
}

.landing-features {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
  gap: 28px;
  margin-top: 80px;
  text-align: left;
}

.feature-card {
  background: var(--bg-secondary);
  padding: 32px;
  border-radius: 16px;
  border: 1px solid var(--border-color);
  transition: all 0.3s;
}

.feature-card:hover {
  transform: translateY(-4px);
  box-shadow: var(--shadow-md);
  border-color: var(--border-hover);
}

.feature-icon {
  font-size: 40px;
  margin-bottom: 20px;
}

.feature-title {
  font-size: 19px;
  font-weight: 700;
  margin-bottom: 12px;
  letter-spacing: -0.3px;
}

.feature-description {
  color: var(--text-secondary);
  line-height: 1.6;
  font-size: 14px;
}

/* ============================================
   STATS GRID
   ============================================ */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
  gap: 16px;
  margin-bottom: 24px;
}

.stat-item {
  background: var(--bg-tertiary);
  padding: 20px;
  border-radius: 12px;
  text-align: center;
  border: 1px solid var(--border-color);
  transition: all 0.2s;
}

.stat-item:hover {
  background: var(--bg-elevated);
  border-color: var(--border-hover);
  transform: translateY(-2px);
}

.stat-value {
  font-size: 32px;
  font-weight: 800;
  margin-bottom: 6px;
  background: linear-gradient(135deg, var(--accent-blue), var(--accent-green));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.stat-label {
  color: var(--text-secondary);
  font-size: 12px;
  font-weight: 600;
}

/* ============================================
   FOOTER
   ============================================ */
.footer {
  background: var(--bg-secondary);
  border-top: 1px solid var(--border-color);
  padding: 48px 20px 32px;
  margin-top: 80px;
}

.footer-content {
  max-width: 1200px;
  margin: 0 auto;
}

.disclaimer {
  background: var(--bg-tertiary);
  padding: 28px;
  border-radius: 12px;
  border-left: 4px solid var(--accent-yellow);
  margin-bottom: 32px;
  border: 1px solid var(--border-color);
}

.disclaimer-title {
  font-weight: 700;
  margin-bottom: 20px;
  display: flex;
  align-items: center;
  gap: 10px;
  font-size: 16px;
}

.disclaimer-list {
  list-style: none;
  color: var(--text-secondary);
  font-size: 13px;
  line-height: 1.8;
}

.disclaimer-list li {
  margin-bottom: 10px;
  padding-left: 24px;
  position: relative;
}

.disclaimer-list li:before {
  content: "‚Ä¢";
  position: absolute;
  left: 0;
  color: var(--accent-yellow);
  font-weight: 700;
}

.disclaimer-list strong {
  color: var(--text-primary);
}

.footer-links {
  display: flex;
  gap: 32px;
  justify-content: center;
  color: var(--text-secondary);
  font-size: 13px;
  flex-wrap: wrap;
}

.footer-links a {
  color: var(--text-secondary);
  text-decoration: none;
  cursor: pointer;
  transition: color 0.2s;
}

.footer-links a:hover {
  color: var(--text-primary);
}

/* ============================================
   ALERT
   ============================================ */
.alert {
  padding: 16px 20px;
  border-radius: 10px;
  margin-bottom: 20px;
  border: 1px solid;
  display: flex;
  align-items: flex-start;
  gap: 12px;
  font-size: 14px;
}

.alert-warning {
  background: rgba(245, 158, 11, 0.1);
  border-color: rgba(245, 158, 11, 0.3);
  color: var(--accent-yellow);
}

.alert-info {
  background: rgba(37, 99, 235, 0.1);
  border-color: rgba(37, 99, 235, 0.3);
  color: var(--accent-blue);
}

.alert-error {
  background: rgba(239, 68, 68, 0.1);
  border-color: rgba(239, 68, 68, 0.3);
  color: var(--accent-red);
}

.alert-success {
  background: rgba(16, 185, 129, 0.1);
  border-color: rgba(16, 185, 129, 0.3);
  color: var(--accent-green);
}

/* ============================================
   UTILITY CLASSES
   ============================================ */
.hidden {
  display: none !important;
}

.text-center {
  text-align: center;
}

.text-secondary {
  color: var(--text-secondary);
}

.flex {
  display: flex;
}

.flex-between {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.flex-center {
  display: flex;
  align-items: center;
  gap: 8px;
}

.gap-16 {
  gap: 16px;
}

.mb-8 {
  margin-bottom: 8px;
}

.mb-16 {
  margin-bottom: 16px;
}

.mb-24 {
  margin-bottom: 24px;
}

.mt-16 {
  margin-top: 16px;
}

.mt-24 {
  margin-top: 24px;
}

/* ============================================
   RESPONSIVE
   ============================================ */
@media (max-width: 768px) {
  .landing-title {
    font-size: 42px;
  }

  .landing-subtitle {
    font-size: 18px;
  }

  .modal {
    padding: 28px;
  }

  .reputation-number {
    font-size: 48px;
  }

  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }

  .radio-group {
    grid-template-columns: repeat(2, 1fr);
  }
}

@media (max-width: 480px) {
  .landing-title {
    font-size: 32px;
  }

  .landing-subtitle {
    font-size: 16px;
  }

  .landing-cta {
    flex-direction: column;
  }

  .landing-cta .btn {
    width: 100%;
  }
}

/* ============================================
   PASSWORD STRENGTH
   ============================================ */
.password-strength {
  display: flex;
  gap: 6px;
  margin-top: 10px;
}

.strength-bar {
  flex: 1;
  height: 4px;
  background: var(--bg-tertiary);
  border-radius: 2px;
  transition: all 0.3s;
}

.strength-bar.active {
  background: var(--accent-green);
}

.strength-bar.weak {
  background: var(--accent-red);
}

.strength-bar.medium {
  background: var(--accent-yellow);
}

/* ============================================
   COUNTDOWN
   ============================================ */
.countdown {
  font-size: 28px;
  font-weight: 700;
  color: var(--accent-blue);
  text-align: center;
  margin: 20px 0;
  font-family: 'JetBrains Mono', monospace;
}

/* ============================================
   CONFETTI (Success Animation)
   ============================================ */
@keyframes confetti-fall {
  0% {
    transform: translateY(-100vh) rotate(0deg);
    opacity: 1;
  }
  100% {
    transform: translateY(100vh) rotate(720deg);
    opacity: 0;
  }
}

.confetti {
  position: fixed;
  width: 10px;
  height: 10px;
  background: var(--accent-green);
  top: -10px;
  animation: confetti-fall 3s linear;
  pointer-events: none;
  z-index: 10002;
}

  </style>
</head>
<body>

  <!-- Legal Sticky Banner -->

  <div id="legalSticky" class="legal-sticky">
    ‚ö†Ô∏è BoostCircle is a coordination tool ONLY. We do NOT send boosts. You must use the Chime app. We are NOT affiliated with Chime.
  </div>

  <!-- Header -->

  <header class="header">
    <div class="header-content">
      <div class="logo" onclick="render()">BoostCircle</div>
      <div id="headerActions" class="header-actions"></div>
    </div>
  </header>

  <!-- Main Content -->

  <main id="mainContent"></main>

  <!-- Footer -->

  <footer class="footer">
    <div class="footer-content">
      <div class="disclaimer">
        <div class="disclaimer-title">
          üö® CRITICAL DISCLAIMERS
        </div>
        <ul class="disclaimer-list">
          <li><strong>NOT AFFILIATED WITH CHIME:</strong> This app is an independent coordination tool. Chime has not endorsed this.</li>
          <li><strong>NO MONEY MOVEMENT:</strong> BoostCircle does not access your bank account or move any money.</li>
          <li><strong>YOU SEND BOOSTS IN CHIME APP:</strong> All SpotMe Boosts must be sent through the official Chime mobile app.</li>
          <li><strong>NO LEGAL OBLIGATIONS:</strong> Boost commitments are social agreements, not contracts.</li>
          <li><strong>NO GUARANTEES:</strong> We cannot guarantee other members will fulfill commitments.</li>
          <li><strong>NO CREDENTIALS STORED:</strong> We never ask for your Chime login or banking info.</li>
          <li><strong>NO LIABILITY:</strong> We are not responsible for failed boosts, account issues, or financial losses.</li>
          <li><strong>CHIME RULES APPLY:</strong> You must follow Chime's terms of service for SpotMe.</li>
        </ul>
      </div>
      <div class="footer-links">
        <a onclick="showFAQ()">FAQ</a>
        <a onclick="showSupport()">Report Issues</a>
        <a onclick="showPrivacy()">Privacy</a>
        <a onclick="toggleDebugMode()">Debug Mode</a>
      </div>
    </div>
  </footer>

  <!-- Modals -->

  <div id="modalOverlay" class="modal-overlay">
    <div id="modalContent" class="modal"></div>
  </div>

  <script>
    // ============================================
    // CONSTANTS & CONFIGURATION
    // ============================================

    const STORAGE_KEYS = {
      USERS: 'boostcircle_users_v2',
      GROUPS: 'boostcircle_groups_v2',
      SESSION: 'boostcircle_session_v2',
      DISPUTES: 'boostcircle_disputes_v2',
      NOTIFICATIONS: 'boostcircle_notifications_v2'
    };

    const ELIGIBILITY_TIERS = {
      FULL_MEMBER: {
        canSend: 4,
        canReceive: 4,
        requirements: 'Active Chime card + $200+ direct deposit monthly',
        label: 'Full Member'
      },
      LIMITED_MEMBER: {
        canSend: 1,
        canReceive: 1,
        requirements: 'Active Chime card, no direct deposit requirement',
        label: 'Limited Member'
      },
      BLOCKED: {
        canSend: 0,
        canReceive: 0,
        requirements: 'Must repay outstanding SpotMe balance first',
        warningMessage: '‚ö†Ô∏è You have an outstanding SpotMe balance. New boosts won\'t increase your limit until you repay.',
        label: 'Blocked'
      }
    };

    const BOOST_STATES = {
      PENDING: 'pending',
      SENDER_CONFIRMED: 'sender_confirmed',
      CONFIRMED: 'confirmed',
      FAILED: 'failed',
      EXPIRED: 'expired',
      DISPUTED: 'disputed',
      CANCELLED: 'cancelled'
    };

    const AUTO_KICK_RULES = {
      REPUTATION_THRESHOLD: 30,
      STRIKES_LIMIT: 2,
      DISPUTE_LIMIT: 3
    };

    const DEBUG_MODE = localStorage.getItem('debug_mode') === 'true';

    // ============================================
    // DEBUG UTILITIES
    // ============================================

    function debugLog(...args) {
      if (DEBUG_MODE) {
        console.log('[DEBUG]', ...args);
      }
    }

    function toggleDebugMode() {
      const newState = !DEBUG_MODE;
      localStorage.setItem('debug_mode', newState ? 'true' : 'false');
      location.reload();
    }

    // Expose debug controls
    if (DEBUG_MODE) {
      window.BoostCircleDebug = {
        clearData: () => clearAllData(),
        addReputation: (userId, amount) => updateReputation(userId, amount),
        forceMonthlyReset: () => {
          Object.values(getAllGroups()).forEach(g => {
            performMonthlyReset(g.id);
          });
        },
        simulateExpiredBoost: (groupId) => {
          const group = getGroup(groupId);
          const currentMonth = getCurrentMonthKey();
          if (group.monthlyAssignments[currentMonth][0]) {
            group.monthlyAssignments[currentMonth][0].expiresAt = Date.now() - 1000;
            saveGroup(group);
            checkExpiredBoosts();
          }
        },
        viewStorage: () => {
          console.log('Users:', getAllUsers());
          console.log('Groups:', getAllGroups());
          console.log('Notifications:', notifications.getAll());
        }
      };
      console.log('Debug mode enabled. Access via window.BoostCircleDebug');
    }

    // ============================================
    // STORAGE UTILITIES
    // ============================================

    function getFromStorage(key) {
      try {
        const data = localStorage.getItem(key);
        return data ? JSON.parse(data) : null;
      } catch (e) {
        console.error('Storage read error:', e);
        showErrorScreen(e);
        return null;
      }
    }

    function saveToStorage(key, data) {
      try {
        localStorage.setItem(key, JSON.stringify(data));
        return true;
      } catch (e) {
        console.error('Storage write error:', e);
        if (e.name === 'QuotaExceededError') {
          notifications.create({
            type: 'error',
            message: 'Storage quota exceeded. Please clear some data.',
            severity: 'error'
          });
        }
        return false;
      }
    }

    function safeExecute(fn, fallback) {
      try {
        return fn();
      } catch (error) {
        console.error('Safe execute error:', error);
        if (fallback) fallback(error);
        return null;
      }
    }

    function getAllUsers() {
      return getFromStorage(STORAGE_KEYS.USERS) || {};
    }

    function getUser(userId) {
      return getAllUsers()[userId];
    }

    function saveUser(user) {
      const users = getAllUsers();
      users[user.id] = user;
      return saveToStorage(STORAGE_KEYS.USERS, users);
    }

    function getAllGroups() {
      return getFromStorage(STORAGE_KEYS.GROUPS) || {};
    }

    function getGroup(groupId) {
      return getAllGroups()[groupId];
    }

    function saveGroup(group) {
      const groups = getAllGroups();
      groups[group.id] = group;
      return saveToStorage(STORAGE_KEYS.GROUPS, groups);
    }

    function getSession() {
      const session = getFromStorage(STORAGE_KEYS.SESSION);
      if (session && session.expiresAt > Date.now()) {
        return session;
      }
      return null;
    }

    function saveSession(userId, rememberMe = false) {
      const duration = rememberMe ? 90 : 30;
      const session = {
        userId,
        token: generateId(),
        expiresAt: Date.now() + duration * 24 * 60 * 60 * 1000
      };
      saveToStorage(STORAGE_KEYS.SESSION, session);
      return session;
    }

    function clearSession() {
      localStorage.removeItem(STORAGE_KEYS.SESSION);
    }

    function clearAllData() {
      if (confirm('This will delete ALL your data. Are you absolutely sure?')) {
        Object.values(STORAGE_KEYS).forEach(key => {
          localStorage.removeItem(key);
        });
        location.reload();
      }
    }

    // ============================================
    // AUTHENTICATION
    // ============================================

    async function hashPassword(password) {
      const encoder = new TextEncoder();
      const data = encoder.encode(password);
      const hashBuffer = await crypto.subtle.digest('SHA-256', data);
      const hashArray = Array.from(new Uint8Array(hashBuffer));
      return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
    }

    function generateId() {
      return 'id_' + Math.random().toString(36).substr(2, 9) + Date.now().toString(36);
    }

    function validateEmail(email) {
      return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
    }

    function validateChimeSign(sign) {
      return /^\$[a-zA-Z0-9]{3,15}$/.test(sign);
    }

    function calculateAge(birthday) {
      const today = new Date();
      const birthDate = new Date(birthday);
      let age = today.getFullYear() - birthDate.getFullYear();
      const monthDiff = today.getMonth() - birthDate.getMonth();
      if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
        age--;
      }
      return age;
    }

    function calculatePasswordStrength(password) {
      let strength = 0;
      if (password.length >= 8) strength++;
      if (password.length >= 12) strength++;
      if (/[a-z]/.test(password) && /[A-Z]/.test(password)) strength++;
      if (/[0-9]/.test(password)) strength++;
      if (/[^a-zA-Z0-9]/.test(password)) strength++;
      return Math.min(strength, 4);
    }

    // ============================================
    // REPUTATION SYSTEM
    // ============================================

    function getReputationLevel(score) {
      if (score >= 90) return { level: 'Excellent', color: 'excellent', badge: 'green' };
      if (score >= 70) return { level: 'Good', color: 'good', badge: 'blue' };
      if (score >= 50) return { level: 'Fair', color: 'fair', badge: 'yellow' };
      return { level: 'Poor', color: 'poor', badge: 'red' };
    }

    function updateReputation(userId, change) {
      const users = getAllUsers();
      const user = users[userId];
      if (!user) return;
      
      user.reputation = Math.max(0, Math.min(100, user.reputation + change));
      saveUser(user);
      
      debugLog(`Reputation updated for ${user.fullName}: ${change > 0 ? '+' : ''}${change} (now ${user.reputation})`);
    }

    // ============================================
    // NOTIFICATION SYSTEM
    // ============================================

    const notifications = {
      create(notification) {
        const allNotifications = this.getAll();
        const newNotif = {
          id: generateId(),
          userId: notification.userId,
          type: notification.type,
          message: notification.message,
          severity: notification.severity || 'info',
          createdAt: Date.now(),
          read: false
        };
        allNotifications.push(newNotif);
        saveToStorage(STORAGE_KEYS.NOTIFICATIONS, allNotifications);
        this.showToast(newNotif);
        this.updateBadge();
        debugLog('Notification created:', newNotif);
      },
      
      getAll() {
        return getFromStorage(STORAGE_KEYS.NOTIFICATIONS) || [];
      },
      
      getForUser(userId) {
        return this.getAll().filter(n => n.userId === userId);
      },
      
      getUnread(userId) {
        return this.getForUser(userId).filter(n => !n.read);
      },
      
      markRead(notificationId) {
        const allNotifications = this.getAll();
        const notif = allNotifications.find(n => n.id === notificationId);
        if (notif) {
          notif.read = true;
          saveToStorage(STORAGE_KEYS.NOTIFICATIONS, allNotifications);
          this.updateBadge();
        }
      },
      
      markAllRead(userId) {
        const allNotifications = this.getAll();
        allNotifications.forEach(n => {
          if (n.userId === userId) n.read = true;
        });
        saveToStorage(STORAGE_KEYS.NOTIFICATIONS, allNotifications);
        this.updateBadge();
      },
      
      showToast(notification) {
        const toast = document.createElement('div');
        toast.className = `toast toast-${notification.severity}`;
        toast.innerHTML = `
          <div class="toast-icon">${this.getIcon(notification.type)}</div>
          <div class="toast-content">
            <div class="toast-title">${this.getTitle(notification.type)}</div>
            <div class="toast-message">${notification.message}</div>
          </div>
        `;
        document.body.appendChild(toast);
        
        setTimeout(() => toast.classList.add('show'), 10);
        setTimeout(() => {
          toast.classList.remove('show');
          setTimeout(() => toast.remove(), 300);
        }, 5000);
      },
      
      getIcon(type) {
        const icons = {
          boost_confirmed: '‚úÖ',
          boost_expired: '‚è∞',
          new_month_reminder: 'üìÖ',
          urgent_reminder: '‚ö†Ô∏è',
          final_reminder: 'üö®',
          auto_kicked: '‚ùå',
          member_auto_kicked: 'üë§',
          strike_warning: '‚ö°',
          removed_from_group: 'üö™',
          error: '‚ùå',
          success: '‚úÖ',
          warning: '‚ö†Ô∏è',
          info: '‚ÑπÔ∏è'
        };
        return icons[type] || '‚ÑπÔ∏è';
      },
      
      getTitle(type) {
        const titles = {
          boost_confirmed: 'Boost Confirmed',
          boost_expired: 'Boost Expired',
          new_month_reminder: 'New Month',
          urgent_reminder: 'Urgent',
          final_reminder: 'Final Warning',
          auto_kicked: 'Removed from Group',
          member_auto_kicked: 'Member Removed',
          strike_warning: 'Strike Warning',
          removed_from_group: 'Group Removal',
          error: 'Error',
          success: 'Success',
          warning: 'Warning',
          info: 'Info'
        };
        return titles[type] || 'Notification';
      },
      
      updateBadge() {
        const session = getSession();
        if (!session) return;
        
        const unreadCount = this.getUnread(session.userId).length;
        const badge = document.getElementById('notificationBadge');
        if (badge) {
          badge.textContent = unreadCount;
          badge.classList.toggle('hidden', unreadCount === 0);
        }
      }
    };

    // ============================================
    // LOADING STATES
    // ============================================

    function showLoading(message = 'Loading...') {
      hideLoading(); // Remove existing loader
      const loader = document.createElement('div');
      loader.id = 'globalLoader';
      loader.className = 'global-loader';
      loader.innerHTML = `
        <div class="loader-content">
          <div class="spinner"></div>
          <div class="loader-message">${message}</div>
        </div>
      `;
      document.body.appendChild(loader);
    }

    function hideLoading() {
      const loader = document.getElementById('globalLoader');
      if (loader) loader.remove();
    }

    // ============================================
    // ERROR HANDLING
    // ============================================

    window.addEventListener('error', (event) => {
      console.error('Global error:', event.error);
      showErrorScreen(event.error);
    });

    window.addEventListener('unhandledrejection', (event) => {
      console.error('Unhandled promise rejection:', event.reason);
      showErrorScreen(event.reason);
    });

    function showErrorScreen(error) {
      const mainContent = document.getElementById('mainContent');
      mainContent.innerHTML = `
        <div class="container">
          <div class="card" style="text-align: center; max-width: 600px; margin: 80px auto;">
            <div style="font-size: 72px; margin-bottom: 20px;">üòï</div>
            <h2 class="card-title">Something Went Wrong</h2>
            <p class="text-secondary" style="margin-bottom: 28px; font-size: 15px;">
              Don't worry - your data is safe. Try refreshing the page.
            </p>
            <div class="alert alert-error" style="text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 12px; margin-bottom: 28px;">
              ${error.message || error.toString()}
            </div>
            <div style="display: flex; gap: 16px; flex-wrap: wrap;">
              <button class="btn btn-primary" onclick="location.reload()" style="flex: 1;">Refresh Page</button>
              <button class="btn btn-secondary" onclick="clearAllData()" style="flex: 1;">Clear Data & Start Fresh</button>
            </div>
          </div>
        </div>
      `;
    }

    // ============================================
    // DATE UTILITIES
    // ============================================

    function getCurrentMonthKey() {
      const now = new Date();
      return `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}`;
    }

    function getPreviousMonthKey(monthYear) {
      const [year, month] = monthYear.split('-').map(Number);
      const prevMonth = month === 1 ? 12 : month - 1;
      const prevYear = month === 1 ? year - 1 : year;
      return `${prevYear}-${String(prevMonth).padStart(2, '0')}`;
    }

    function getMonthName(monthYear) {
      const [year, month] = monthYear.split('-').map(Number);
      const date = new Date(year, month - 1);
      return date.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
    }

    function getMonthResetCountdown() {
      const now = new Date();
      const nextMonth = new Date(now.getFullYear(), now.getMonth() + 1, 1);
      const diff = nextMonth - now;
      
      const days = Math.floor(diff / (1000 * 60 * 60 * 24));
      const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      
      return `${days}d ${hours}h`;
    }

    function getMonthEndTimestamp(monthYear) {
      const [year, month] = monthYear.split('-').map(Number);
      const lastDay = new Date(year, month, 0);
      lastDay.setHours(23, 59, 59, 999);
      return lastDay.getTime();
    }

    // ============================================
    // PAIRING ALGORITHM
    // ============================================

    function generatePairings(groupId, monthYear) {
      const groups = getAllGroups();
      const group = groups[groupId];
      if (!group) return [];

      const users = getAllUsers();
      const members = group.memberIds.map(id => users[id]).filter(Boolean);
      
      const pairings = [];
      const sends = {};
      const receives = {};

      members.forEach(m => {
        sends[m.id] = 0;
        receives[m.id] = 0;
      });

      const previousMonth = getPreviousMonthKey(monthYear);
      const previousPairings = group.monthlyAssignments?.[previousMonth] || [];
      const previousPairs = new Set(previousPairings.map(p => `${p.senderId}-${p.receiverId}`));

      // Sort members by eligibility and reputation
      const sortedMembers = [...members].sort((a, b) => {
        const aBoosts = ELIGIBILITY_TIERS[a.chimeEligibility].canSend;
        const bBoosts = ELIGIBILITY_TIERS[b.chimeEligibility].canSend;
        if (aBoosts !== bBoosts) return bBoosts - aBoosts;
        return b.reputation - a.reputation;
      });

      sortedMembers.forEach(sender => {
        const eligibility = ELIGIBILITY_TIERS[sender.chimeEligibility];
        const availableBoosts = eligibility.canSend;

        if (sender.chimeEligibility === 'BLOCKED' || availableBoosts === 0) {
          debugLog(`Skipping ${sender.fullName} - blocked or no boosts`);
          return;
        }

        let sent = 0;

        const candidates = members
          .filter(r => r.id !== sender.id)
          .sort((a, b) => {
            const prevA = previousPairs.has(`${sender.id}-${a.id}`) ? 1 : 0;
            const prevB = previousPairs.has(`${sender.id}-${b.id}`) ? 1 : 0;
            if (prevA !== prevB) return prevA - prevB;
            return receives[a.id] - receives[b.id];
          });

        for (const receiver of candidates) {
          if (sent >= availableBoosts) break;

          const monthEnd = getMonthEndTimestamp(monthYear);
          pairings.push({
            senderId: sender.id,
            receiverId: receiver.id,
            status: BOOST_STATES.PENDING,
            senderConfirmedAt: null,
            receiverConfirmedAt: null,
            failureReason: null,
            expiresAt: monthEnd,
            isExpired: false,
            disputeId: null,
            remindersSent: 0,
            lastReminderAt: null,
            createdAt: Date.now(),
            failedAt: null,
            expiredAt: null,
            cancelledAt: null,
            cancelledBy: null
          });

          sends[sender.id]++;
          receives[receiver.id]++;
          sent++;
        }
      });

      debugLog(`Generated ${pairings.length} pairings for group ${group.name}`);
      return pairings;
    }

    function ensureMonthlyAssignments(groupId) {
      const groups = getAllGroups();
      const group = groups[groupId];
      if (!group) return;

      const currentMonth = getCurrentMonthKey();
      
      if (!group.monthlyAssignments) {
        group.monthlyAssignments = {};
      }

      if (!group.monthlyAssignments[currentMonth]) {
        group.monthlyAssignments[currentMonth] = generatePairings(groupId, currentMonth);
        saveGroup(group);
        debugLog(`Created assignments for ${group.name} - ${currentMonth}`);
      }
    }

    // ============================================
    // MONTHLY RESET & EXPIRED BOOSTS
    // ============================================

    function checkAndPerformMonthlyReset() {
      const groups = getAllGroups();
      const currentMonth = getCurrentMonthKey();

      Object.values(groups).forEach(group => {
        if (!group.lastResetMonth || group.lastResetMonth !== currentMonth) {
          performMonthlyReset(group.id);
        }
      });
    }

    function performMonthlyReset(groupId) {
      const groups = getAllGroups();
      const group = groups[groupId];
      if (!group) return;

      const currentMonth = getCurrentMonthKey();
      const previousMonth = getPreviousMonthKey(currentMonth);

      debugLog(`Performing monthly reset for ${group.name}`);

      if (group.monthlyAssignments?.[previousMonth]) {
        const pairings = group.monthlyAssignments[previousMonth];
        
        group.memberIds.forEach(memberId => {
          const memberSends = pairings.filter(p => p.senderId === memberId);
          const confirmedSends = memberSends.filter(p => p.status === BOOST_STATES.CONFIRMED).length;
          const totalSends = memberSends.length;

          if (totalSends > 0 && confirmedSends === totalSends) {
            updateReputation(memberId, 5);
            debugLog(`+5 rep to ${getUser(memberId).fullName} - perfect month`);
          } else if (confirmedSends < totalSends) {
            const penalty = -5 * (totalSends - confirmedSends);
            updateReputation(memberId, penalty);
            debugLog(`${penalty} rep to ${getUser(memberId).fullName} - incomplete month`);
          }
        });

        evaluateAutoKicks(group.id, previousMonth);
      }

      group.monthlyAssignments = group.monthlyAssignments || {};
      group.monthlyAssignments[currentMonth] = generatePairings(groupId, currentMonth);
      group.lastResetMonth = currentMonth;
      
      saveGroup(group);
      
      // Send new month notifications
      group.memberIds.forEach(memberId => {
        const userSends = group.monthlyAssignments[currentMonth].filter(a => a.senderId === memberId);
        if (userSends.length > 0) {
          notifications.create({
            userId: memberId,
            type: 'new_month_reminder',
            message: `New month! You have ${userSends.length} boosts to send in ${group.name}`,
            severity: 'info'
          });
        }
      });
    }

    function checkExpiredBoosts() {
      const groups = getAllGroups();
      const currentMonth = getCurrentMonthKey();
      const now = Date.now();

      Object.values(groups).forEach(group => {
        const assignments = group.monthlyAssignments[currentMonth];
        if (!assignments) return;

        let hasChanges = false;
        
        assignments.forEach(assignment => {
          if ((assignment.status === BOOST_STATES.PENDING || 
               assignment.status === BOOST_STATES.SENDER_CONFIRMED) &&
              now > assignment.expiresAt) {
            assignment.status = BOOST_STATES.EXPIRED;
            assignment.isExpired = true;
            assignment.expiredAt = now;
            hasChanges = true;

            const penalty = assignment.status === BOOST_STATES.PENDING ? -10 : -5;
            updateReputation(assignment.senderId, penalty);

            notifications.create({
              userId: assignment.senderId,
              type: 'boost_expired',
              message: `Your boost to ${getUser(assignment.receiverId).chimeSign} expired. ${penalty} reputation.`,
              severity: 'error'
            });

            notifications.create({
              userId: assignment.receiverId,
              type: 'boost_expired',
              message: `Boost from ${getUser(assignment.senderId).chimeSign} never arrived.`,
              severity: 'warning'
            });

            debugLog(`Boost expired: ${getUser(assignment.senderId).chimeSign} -> ${getUser(assignment.receiverId).chimeSign}`);
          }
        });

        if (hasChanges) {
          saveGroup(group);
        }
      });
    }

    // ============================================
    // AUTO-KICK SYSTEM
    // ============================================

    function evaluateAutoKicks(groupId, monthYear) {
      const group = getGroup(groupId);
      if (!group) return;

      const assignments = group.monthlyAssignments[monthYear];
      
      group.memberIds.forEach(memberId => {
        const user = getUser(memberId);
        if (!user) return;

        const memberSends = assignments.filter(a => a.senderId === memberId);
        const failedSends = memberSends.filter(a => 
          a.status === BOOST_STATES.FAILED || a.status === BOOST_STATES.EXPIRED
        );

        if (failedSends.length >= memberSends.length / 2 && memberSends.length > 0) {
          if (!user.strikes) {
            user.strikes = { count: 0, history: [], lastStrikeAt: null };
          }

          user.strikes.count++;
          user.strikes.history.push({
            month: monthYear,
            reason: 'failed_boost',
            boostsNotSent: failedSends.length
          });
          user.strikes.lastStrikeAt = Date.now();

          if (user.strikes.count >= AUTO_KICK_RULES.STRIKES_LIMIT || 
              user.reputation < AUTO_KICK_RULES.REPUTATION_THRESHOLD) {
            
            removeUserFromGroup(
              groupId, 
              memberId, 
              'auto_kick', 
              `Reputation too low (${user.reputation}) or too many strikes (${user.strikes.count})`
            );

            notifications.create({
              userId: memberId,
              type: 'auto_kicked',
              message: `You've been removed from ${group.name} due to low reputation (${user.reputation}) and ${user.strikes.count} strikes.`,
              severity: 'error'
            });

            notifications.create({
              userId: group.creatorId,
              type: 'member_auto_kicked',
              message: `${user.fullName} was auto-removed from ${group.name} (rep: ${user.reputation}, strikes: ${user.strikes.count})`,
              severity: 'info'
            });
          } else {
            notifications.create({
              userId: memberId,
              type: 'strike_warning',
              message: `Strike ${user.strikes.count}/${AUTO_KICK_RULES.STRIKES_LIMIT}: Failed to send ${failedSends.length} boosts in ${getMonthName(monthYear)}. One more strike and you'll be removed.`,
              severity: 'warning'
            });
          }

          saveUser(user);
        }
      });
    }

    function removeUserFromGroup(groupId, memberId, kickType, reason, adminId = 'system') {
      const group = getGroup(groupId);
      const user = getUser(memberId);
      if (!group || !user) return;

      group.memberIds = group.memberIds.filter(id => id !== memberId);
      
      if (!group.kickHistory) group.kickHistory = [];
      group.kickHistory.push({
        userId: memberId,
        userName: user.fullName,
        kickType,
        reason,
        kickedBy: adminId,
        kickedAt: Date.now(),
        userReputationAtKick: user.reputation,
        userStrikesAtKick: user.strikes?.count || 0
      });
      
      user.groupIds = user.groupIds.filter(id => id !== groupId);
      
      const penalty = kickType === 'auto_kick' ? -20 : -15;
      updateReputation(memberId, penalty);
      
      saveGroup(group);
      saveUser(user);
      
      debugLog(`Removed ${user.fullName} from ${group.name} (${kickType})`);
    }

    // ============================================
    // SMART REMINDERS
    // ============================================

    function scheduleReminders() {
      const session = getSession();
      if (!session) return;

      const groups = getAllGroups();
      const currentMonth = getCurrentMonthKey();
      const now = new Date();
      const dayOfMonth = now.getDate();
      
      Object.values(groups).forEach(group => {
        if (!group.memberIds.includes(session.userId)) return;
        
        const assignments = group.monthlyAssignments[currentMonth];
        if (!assignments) return;

        const userSends = assignments.filter(a => 
          a.senderId === session.userId && 
          a.status === BOOST_STATES.PENDING
        );
        
        if (userSends.length === 0) return;

        if (dayOfMonth === 25) {
          notifications.create({
            userId: session.userId,
            type: 'urgent_reminder',
            message: `‚è∞ 5 days left! ${userSends.length} pending boosts in ${group.name}`,
            severity: 'warning'
          });
        }
        
        if (dayOfMonth === 28) {
          notifications.create({
            userId: session.userId,
            type: 'final_reminder',
            message: `üö® LAST CHANCE! Send ${userSends.length} boosts before midnight or face reputation penalty`,
            severity: 'error'
          });
        }
      });
    }

    // ============================================
    // ANALYTICS
    // ============================================

    function calculateUserStats(userId, groups) {
      let totalSent = 0;
      let totalReceived = 0;
      let totalExpected = 0;
      
      groups.forEach(group => {
        Object.values(group.monthlyAssignments || {}).forEach(assignments => {
          const sent = assignments.filter(a => a.senderId === userId && a.status === BOOST_STATES.CONFIRMED);
          const received = assignments.filter(a => a.receiverId === userId && a.status === BOOST_STATES.CONFIRMED);
          const expected = assignments.filter(a => a.senderId === userId);
          
          totalSent += sent.length;
          totalReceived += received.length;
          totalExpected += expected.length;
        });
      });
      
      const allMonths = new Set();
      groups.forEach(g => {
        Object.keys(g.monthlyAssignments || {}).forEach(m => allMonths.add(m));
      });
      
      return {
        totalBoostsSent: totalSent,
        totalBoostsReceived: totalReceived,
        reliabilityRate: totalExpected > 0 ? Math.round((totalSent / totalExpected) * 100) : 100,
        monthsActive: allMonths.size
      };
    }

    // ============================================
    // UI RENDERING
    // ============================================

    let currentView = 'landing';
    let modalState = {};

    function render() {
      safeExecute(() => {
        checkAndPerformMonthlyReset();
        checkExpiredBoosts();

        const session = getSession();
        
        if (!session) {
          renderGuestView();
        } else {
          renderDashboard(session.userId);
        }

        renderHeader(session);
        notifications.updateBadge();
      }, (error) => {
        showErrorScreen(error);
      });
    }

    function renderHeader(session) {
      const headerActions = document.getElementById('headerActions');
      
      if (!session) {
        headerActions.innerHTML = `
          <button class="btn btn-primary" onclick="showSignup()">Get Started</button>
        `;
      } else {
        const users = getAllUsers();
        const user = users[session.userId];
        const initials = user.fullName.split(' ').map(n => n[0]).join('').toUpperCase();
        const unreadCount = notifications.getUnread(session.userId).length;
        
        headerActions.innerHTML = `
          <div class="notification-btn" onclick="showNotifications()">
            üîî
            <span class="notification-badge ${unreadCount === 0 ? 'hidden' : ''}" id="notificationBadge">${unreadCount}</span>
          </div>
          <div class="avatar" onclick="showUserMenu()">${initials}</div>
        `;
      }
    }

    function renderGuestView() {
      const mainContent = document.getElementById('mainContent');
      
      mainContent.innerHTML = `
        <div class="container">
          <div class="landing">
            <h1 class="landing-title">Stop the Boost Anxiety</h1>
            <p class="landing-subtitle">
              Coordinate your monthly Chime SpotMe Boosts with trusted groups. 
              Set it once, forget it forever.
            </p>
            <div class="landing-cta">
              <button class="btn btn-primary" onclick="showSignup()">Get Started Free</button>
              <button class="btn btn-secondary" onclick="showLogin()">Login</button>
            </div>

            <div class="landing-features">
              <div class="feature-card">
                <div class="feature-icon">üéØ</div>
                <div class="feature-title">Trusted Groups</div>
                <div class="feature-description">
                  Form small circles of 4-10 people who reliably exchange Boosts every month. No more ghosting from strangers.
                </div>
              </div>
              
              <div class="feature-card">
                <div class="feature-icon">ü§ñ</div>
                <div class="feature-title">Auto Pairing</div>
                <div class="feature-description">
                  Smart algorithm ensures fair distribution based on your Chime eligibility. Everyone gives ‚âà everyone receives.
                </div>
              </div>
              
              <div class="feature-card">
                <div class="feature-icon">‚úÖ</div>
                <div class="feature-title">Dual Confirmation</div>
                <div class="feature-description">
                  Both sender and receiver confirm each Boost. Track status in real-time. No confusion.
                </div>
              </div>
              
              <div class="feature-card">
                <div class="feature-icon">‚≠ê</div>
                <div class="feature-title">Reputation System</div>
                <div class="feature-description">
                  Build trust over time. Reliable members earn higher scores. Unreliable members get auto-removed.
                </div>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    function renderDashboard(userId) {
      const users = getAllUsers();
      const user = users[userId];
      const groups = getAllGroups();
      
      const userGroups = Object.values(groups).filter(g => g.memberIds.includes(userId));
      
      const currentMonth = getCurrentMonthKey();
      const firstName = user.fullName.split(' ')[0];
      
      let totalSends = 0;
      let confirmedSends = 0;
      let totalReceives = 0;
      let confirmedReceives = 0;
      let pendingActions = 0;

      userGroups.forEach(group => {
        ensureMonthlyAssignments(group.id);
        const assignments = group.monthlyAssignments?.[currentMonth] || [];
        
        const sends = assignments.filter(a => a.senderId === userId);
        const receives = assignments.filter(a => a.receiverId === userId);
        
        totalSends += sends.length;
        confirmedSends += sends.filter(a => a.status === BOOST_STATES.CONFIRMED).length;
        totalReceives += receives.length;
        confirmedReceives += receives.filter(a => a.status === BOOST_STATES.CONFIRMED).length;
        
        pendingActions += sends.filter(a => a.status === BOOST_STATES.PENDING).length;
        pendingActions += receives.filter(a => 
          a.status === BOOST_STATES.SENDER_CONFIRMED && !a.receiverConfirmedAt
        ).length;
      });

      const eligibility = ELIGIBILITY_TIERS[user.chimeEligibility];
      const boostsUsed = confirmedSends;
      const boostsAvailable = eligibility.canSend;
      const completionPercent = totalSends > 0 ? Math.round((confirmedSends / totalSends) * 100) : 0;

      const repInfo = getReputationLevel(user.reputation);
      const stats = calculateUserStats(userId, userGroups);

      const mainContent = document.getElementById('mainContent');
      mainContent.innerHTML = `
        <div class="container">
          <div style="font-size: 24px; font-weight: 700; margin-bottom: 8px;">
            Hey ${firstName}! üëã
          </div>
          <p class="text-secondary mb-24">${getMonthName(currentMonth)}</p>

          ${pendingActions > 0 ? `
            <div class="alert alert-warning mb-24">
              <span>‚ö°</span>
              <span>You have <strong>${pendingActions} pending actions</strong> that need attention</span>
            </div>
          ` : ''}

          ${user.chimeEligibility === 'BLOCKED' ? `
            <div class="alert alert-error mb-24">
              <span>‚ö†Ô∏è</span>
              <div>
                <strong>Account Blocked</strong><br>
                ${ELIGIBILITY_TIERS.BLOCKED.warningMessage}
              </div>
            </div>
          ` : ''}

          <div class="card">
            <h2 class="card-title">üìÖ ${getMonthName(currentMonth)} Boost Cycle</h2>
            <p class="card-subtitle">Resets in: <span class="countdown">${getMonthResetCountdown()}</span></p>
            <div style="margin-top: 20px;">
              <div class="flex-between mb-8">
                <span>Your Boosts:</span>
                <span><strong>${boostsUsed}</strong> of ${boostsAvailable} used</span>
              </div>
              <div class="flex-between mb-8">
                <span>Boosts Received:</span>
                <span><strong>${confirmedReceives}</strong> of ${totalReceives}</span>
              </div>
              <div class="progress-bar">
                <div class="progress-fill" style="width: ${completionPercent}%"></div>
              </div>
              <p class="text-secondary" style="font-size: 12px; margin-top: 8px;">${completionPercent}% complete</p>
            </div>
          </div>

          <div class="card">
            <h2 class="card-title">Reputation Score</h2>
            <div class="reputation-score">
              <div class="reputation-number ${repInfo.color}">${user.reputation}</div>
              <div class="badge badge-${repInfo.badge}">${repInfo.level}</div>
            </div>
          </div>

          <div class="card">
            <h2 class="card-title">üìä Your Stats</h2>
            <div class="stats-grid">
              <div class="stat-item">
                <div class="stat-value">${stats.totalBoostsSent}</div>
                <div class="stat-label">Total Sent</div>
              </div>
              <div class="stat-item">
                <div class="stat-value">${stats.totalBoostsReceived}</div>
                <div class="stat-label">Total Received</div>
              </div>
              <div class="stat-item">
                <div class="stat-value">${stats.reliabilityRate}%</div>
                <div class="stat-label">Reliability</div>
              </div>
              <div class="stat-item">
                <div class="stat-value">${stats.monthsActive}</div>
                <div class="stat-label">Months Active</div>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="flex-between mb-16">
              <h2 class="card-title">My Groups (${userGroups.length})</h2>
              <button class="btn btn-primary" onclick="showCreateGroup()">Create Group</button>
            </div>
            ${userGroups.length === 0 ? `
              <p class="text-secondary text-center">You're not in any groups yet.</p>
              <button class="btn btn-secondary btn-block mt-16" onclick="showJoinGroup()">Join a Group</button>
            ` : `
              <div class="group-list">
                ${userGroups.map(group => {
                  const assignments = group.monthlyAssignments?.[currentMonth] || [];
                  const pending = assignments.filter(a => 
                    (a.senderId === userId || a.receiverId === userId) && 
                    (a.status === BOOST_STATES.PENDING || 
                     (a.status === BOOST_STATES.SENDER_CONFIRMED && a.receiverId === userId))
                  ).length;
                  
                  const memberReps = group.memberIds.map(id => users[id]?.reputation || 50);
                  const avgRep = Math.round(memberReps.reduce((a, b) => a + b, 0) / memberReps.length);
                  
                  return `
                    <div class="group-item" onclick="showGroupDetail('${group.id}')">
                      <div class="group-header">
                        <div class="group-name">${group.name}</div>
                        <div class="badge badge-blue">${group.memberIds.length} members</div>
                      </div>
                      <div class="group-meta">
                        ${pending > 0 ? `‚è≥ ${pending} pending ‚Ä¢ ` : ''}
                        Avg Rep: ${avgRep}
                      </div>
                    </div>
                  `;
                }).join('')}
              </div>
              <button class="btn btn-secondary btn-block mt-16" onclick="showJoinGroup()">Join Another Group</button>
            `}
          </div>

          ${renderCommitments(userId)}
        </div>
      `;
    }

    function renderCommitments(userId) {
      const users = getAllUsers();
      const groups = getAllGroups();
      const userGroups = Object.values(groups).filter(g => g.memberIds.includes(userId));
      const currentMonth = getCurrentMonthKey();

      let allSends = [];
      let allReceives = [];

      userGroups.forEach(group => {
        const assignments = group.monthlyAssignments?.[currentMonth] || [];
        
        assignments.forEach(a => {
          if (a.senderId === userId) {
            allSends.push({ ...a, groupName: group.name, groupId: group.id });
          }
          if (a.receiverId === userId) {
            allReceives.push({ ...a, groupName: group.name, groupId: group.id });
          }
        });
      });

      if (allSends.length === 0 && allReceives.length === 0) {
        return '';
      }

      const getStatusIcon = (assignment) => {
        switch(assignment.status) {
          case BOOST_STATES.CONFIRMED:
            return '‚úÖ';
          case BOOST_STATES.SENDER_CONFIRMED:
            return '‚è≥';
          case BOOST_STATES.FAILED:
            return '‚ùå';
          case BOOST_STATES.EXPIRED:
            return '‚è∞';
          case BOOST_STATES.DISPUTED:
            return '‚ö†Ô∏è';
          default:
            return '‚ùå';
        }
      };

      const getStatusText = (assignment, isSender) => {
        switch(assignment.status) {
          case BOOST_STATES.CONFIRMED:
            return 'Confirmed';
          case BOOST_STATES.SENDER_CONFIRMED:
            return isSender ? 'Awaiting confirmation' : 'Confirm receipt';
          case BOOST_STATES.FAILED:
            return 'Failed';
          case BOOST_STATES.EXPIRED:
            return 'Expired';
          case BOOST_STATES.DISPUTED:
            return 'Disputed';
          default:
            return 'Pending';
        }
      };

      return `
        <div class="card">
          <h2 class="card-title">This Month's Commitments</h2>
          
          ${allSends.length > 0 ? `
            <div class="mb-24">
              <h3 class="mb-16" style="font-size: 16px; font-weight: 600;">You need to send to:</h3>
              <div class="commitment-list">
                ${allSends.map(send => {
                  const receiver = users[send.receiverId];
                  const icon = getStatusIcon(send);
                  const text = getStatusText(send, true);
                  
                  return `
                    <div class="commitment-item" onclick="showBoostDetail('${send.groupId}', '${send.senderId}', '${send.receiverId}')">
                      <div class="commitment-status">${icon}</div>
                      <div class="commitment-info">
                        <div class="commitment-sign">${receiver.chimeSign}</div>
                        <div class="commitment-meta">${text} ‚Ä¢ ${send.groupName}</div>
                      </div>
                    </div>
                  `;
                }).join('')}
              </div>
            </div>
          ` : ''}

          ${allReceives.length > 0 ? `
            <div>
              <h3 class="mb-16" style="font-size: 16px; font-weight: 600;">You're receiving from:</h3>
              <div class="commitment-list">
                ${allReceives.map(receive => {
                  const sender = users[receive.senderId];
                  const icon = getStatusIcon(receive);
                  const text = getStatusText(receive, false);
                  
                  return `
                    <div class="commitment-item" onclick="showBoostDetail('${receive.groupId}', '${receive.senderId}', '${receive.receiverId}')">
                      <div class="commitment-status">${icon}</div>
                      <div class="commitment-info">
                        <div class="commitment-sign">${sender.chimeSign}</div>
                        <div class="commitment-meta">${text} ‚Ä¢ ${receive.groupName}</div>
                      </div>
                    </div>
                  `;
                }).join('')}
              </div>
            </div>
          ` : ''}
        </div>
      `;
    }

    function showGroupDetail(groupId) {
      const session = getSession();
      const groups = getAllGroups();
      const users = getAllUsers();
      const group = groups[groupId];
      
      if (!group) return;

      const currentMonth = getCurrentMonthKey();
      ensureMonthlyAssignments(groupId);
      const assignments = group.monthlyAssignments?.[currentMonth] || [];
      
      const members = group.memberIds.map(id => users[id]).filter(Boolean);
      const avgRep = Math.round(members.reduce((sum, m) => sum + m.reputation, 0) / members.length);
      
      const currentUserId = session?.userId;
      const isAdmin = group.creatorId === currentUserId;

      const mainContent = document.getElementById('mainContent');
      mainContent.innerHTML = `
        <div class="container">
          <button class="btn btn-secondary mb-16" onclick="render()">‚Üê Back to Dashboard</button>
          
          <div class="card">
            <h1 class="card-title">üéØ ${group.name}</h1>
            <p class="card-subtitle">
              ${members.length} members ‚Ä¢ Group avg rep: ${avgRep}
            </p>

            <div class="mt-24">
              <h3 class="mb-16" style="font-size: 16px; font-weight: 600;">Members</h3>
              <div class="member-list">
                ${members.map(member => {
                  const repInfo = getReputationLevel(member.reputation);
                  const isCreator = member.id === group.creatorId;
                  const isYou = member.id === currentUserId;
                  const eligibility = ELIGIBILITY_TIERS[member.chimeEligibility];
                  
                  return `
                    <div class="member-item">
                      <div class="member-avatar">${member.fullName.split(' ').map(n => n[0]).join('')}</div>
                      <div class="member-info">
                        <div class="member-name">
                          ${isYou ? 'You' : member.fullName} (${member.chimeSign})
                          ${isCreator ? ' ‚Ä¢ Admin' : ''}
                        </div>
                        <div class="member-meta">
                          <span class="badge badge-${repInfo.badge}" style="font-size: 10px;">Rep: ${member.reputation}</span>
                          <span style="font-size: 11px; color: var(--text-muted);">
                            ${eligibility.label} ‚Ä¢ ${eligibility.canSend} boosts/mo
                          </span>
                          ${member.reputation < 50 ? '<span style="font-size: 16px;">‚ö†Ô∏è</span>' : ''}
                        </div>
                      </div>
                      ${isAdmin && !isYou ? `
                        <button class="btn btn-secondary" style="padding: 8px 16px; font-size: 12px;" 
                                onclick="event.stopPropagation(); showMemberManagement('${groupId}', '${member.id}')">
                          Manage
                        </button>
                      ` : ''}
                    </div>
                  `;
                }).join('')}
              </div>
            </div>

            <div class="mt-24">
              <h3 class="mb-16" style="font-size: 16px; font-weight: 600;">
                ${getMonthName(currentMonth)} Boost Matrix
              </h3>
              ${renderBoostMatrix(group, members, assignments, currentUserId)}
            </div>

            <div class="mt-24">
              ${isAdmin ? `
                <button class="btn btn-secondary" onclick="showInviteCode('${groupId}')">
                  Show Invite Code
                </button>
              ` : ''}
              <button class="btn btn-danger" onclick="confirmLeaveGroup('${groupId}')" style="margin-left: 8px;">
                Leave Group
              </button>
            </div>
          </div>
        </div>
      `;
    }

    function renderBoostMatrix(group, members, assignments, currentUserId) {
      const matrix = {};
      members.forEach(sender => {
        matrix[sender.id] = {};
        members.forEach(receiver => {
          matrix[sender.id][receiver.id] = null;
        });
      });

      assignments.forEach(a => {
        if (matrix[a.senderId] && matrix[a.senderId][a.receiverId] !== undefined) {
          matrix[a.senderId][a.receiverId] = a;
        }
      });

      return `
        <div style="overflow-x: auto;">
          <table style="border-collapse: collapse; width: 100%; min-width: 600px; font-size: 13px;">
            <thead>
              <tr>
                <th style="padding: 12px; text-align: center; background: var(--bg-tertiary); border: 1px solid var(--border-color); font-weight: 600;">
                  Sends To ‚Üí
                </th>
                ${members.map(m => `
                  <th style="padding: 12px; text-align: center; background: var(--bg-tertiary); border: 1px solid var(--border-color); font-weight: 600; font-family: 'JetBrains Mono', monospace; font-size: 11px;">
                    ${m.chimeSign.substr(0, 10)}
                  </th>
                `).join('')}
              </tr>
            </thead>
            <tbody>
              ${members.map(sender => `
                <tr>
                  <th style="padding: 12px; text-align: center; background: var(--bg-tertiary); border: 1px solid var(--border-color); font-weight: 600; font-family: 'JetBrains Mono', monospace; font-size: 11px;">
                    ${sender.chimeSign.substr(0, 10)}
                  </th>
                  ${members.map(receiver => {
                    if (sender.id === receiver.id) {
                      return '<td style="padding: 12px; text-align: center; border: 1px solid var(--border-color); color: var(--text-muted);">-</td>';
                    }
                    
                    const assignment = matrix[sender.id][receiver.id];
                    if (!assignment) {
                      return '<td style="padding: 12px; text-align: center; border: 1px solid var(--border-color); color: var(--text-muted);">-</td>';
                    }

                    const icon = assignment.status === BOOST_STATES.CONFIRMED ? '‚úÖ' : 
                                 assignment.status === BOOST_STATES.SENDER_CONFIRMED ? '‚è≥' :
                                 assignment.status === BOOST_STATES.FAILED ? '‚ùå' :
                                 assignment.status === BOOST_STATES.EXPIRED ? '‚è∞' : '‚ùå';
                    
                    return `
                      <td style="padding: 12px; text-align: center; border: 1px solid var(--border-color); cursor: pointer; transition: background 0.2s;" 
                          onclick="showBoostDetail('${group.id}', '${sender.id}', '${receiver.id}')"
                          onmouseover="this.style.background='var(--bg-elevated)'"
                          onmouseout="this.style.background=''">
                        ${icon}
                      </td>
                    `;
                  }).join('')}
                </tr>
              `).join('')}
            </tbody>
          </table>
        </div>
      `;
    }

    function showBoostDetail(groupId, senderId, receiverId) {
      const session = getSession();
      if (!session) return;

      const groups = getAllGroups();
      const users = getAllUsers();
      const group = groups[groupId];
      
      if (!group) return;

      const currentMonth = getCurrentMonthKey();
      const assignments = group.monthlyAssignments?.[currentMonth] || [];
      const assignment = assignments.find(a => a.senderId === senderId && a.receiverId === receiverId);
      
      if (!assignment) return;

      const sender = users[senderId];
      const receiver = users[receiverId];
      const isCurrentUserSender = senderId === session.userId;
      const isCurrentUserReceiver = receiverId === session.userId;

      if (!isCurrentUserSender && !isCurrentUserReceiver) return;

      let content = '';

      if (assignment.status === BOOST_STATES.CONFIRMED) {
        content = `
          <button class="modal-close" onclick="closeModal()">√ó</button>
          <h2 class="modal-title">‚úÖ Boost Confirmed</h2>
          <p class="modal-subtitle">This Boost has been completed</p>

          <div class="card">
            <div class="flex-between mb-8">
              <span class="text-secondary">From:</span>
              <span class="commitment-sign">${sender.chimeSign}</span>
            </div>
            <div class="flex-between mb-8">
              <span class="text-secondary">To:</span>
              <span class="commitment-sign">${receiver.chimeSign}</span>
            </div>
            <div class="flex-between">
              <span class="text-secondary">Status:</span>
              <span class="badge badge-green">Confirmed</span>
            </div>
          </div>

          <button class="btn btn-secondary btn-block mt-24" onclick="closeModal()">Close</button>
        `;
      } else if (isCurrentUserSender && !assignment.senderConfirmedAt) {
        content = `
          <button class="modal-close" onclick="closeModal()">√ó</button>
          <h2 class="modal-title">‚è≥ Send Boost to ${receiver.chimeSign}</h2>
          <p class="modal-subtitle">Follow these steps to complete your commitment</p>

          <div class="card">
            <ol style="padding-left: 20px; color: var(--text-secondary); line-height: 2;">
              <li>Open the <strong style="color: var(--text-primary);">Chime app</strong> on your phone</li>
              <li>Go to the <strong style="color: var(--text-primary);">Friends tab</strong></li>
              <li>Send a <strong style="color: var(--text-primary);">$5 SpotMe Boost</strong> to <span class="commitment-sign" style="color: var(--accent-green);">${receiver.chimeSign}</span></li>
              <li>Come back here and confirm</li>
            </ol>
          </div>

          <div style="display: flex; gap: 12px; margin-top: 24px;">
            <button class="btn btn-success btn-block" onclick="confirmSendBoost('${groupId}', '${senderId}', '${receiverId}')">
              I Sent the Boost ‚úì
            </button>
            <button class="btn btn-secondary" onclick="showFailureReasons('${groupId}', '${senderId}', '${receiverId}')" style="padding: 12px 20px;">
              Can't Send
            </button>
          </div>
        `;
      } else if (isCurrentUserSender && assignment.senderConfirmedAt) {
        content = `
          <button class="modal-close" onclick="closeModal()">√ó</button>
          <h2 class="modal-title">‚è≥ Waiting for Confirmation</h2>
          <p class="modal-subtitle">You've marked this as sent. Waiting for ${receiver.chimeSign} to confirm receipt.</p>

          <div class="card">
            <div class="flex-between mb-8">
              <span class="text-secondary">To:</span>
              <span class="commitment-sign">${receiver.chimeSign}</span>
            </div>
            <div class="flex-between">
              <span class="text-secondary">Your Status:</span>
              <span class="badge badge-blue">Sent</span>
            </div>
          </div>

          <button class="btn btn-secondary btn-block mt-24" onclick="closeModal()">Close</button>
        `;
      } else if (isCurrentUserReceiver && assignment.senderConfirmedAt && !assignment.receiverConfirmedAt) {
        content = `
          <button class="modal-close" onclick="closeModal()">√ó</button>
          <h2 class="modal-title">üîî Confirm Receipt</h2>
          <p class="modal-subtitle">${sender.chimeSign} says they sent you a Boost</p>

          <div class="card">
            <p style="font-size: 15px;">Did you receive <strong style="color: var(--accent-green);">+$5</strong> to your SpotMe limit in the Chime app?</p>
          </div>

          <div style="display: flex; gap: 16px; margin-top: 24px;">
            <button class="btn btn-success btn-block" onclick="confirmReceiveBoost('${groupId}', '${senderId}', '${receiverId}')">
              Yes, I Got It ‚úì
            </button>
            <button class="btn btn-danger btn-block" onclick="reportIssue('${groupId}', '${senderId}', '${receiverId}')">
              Report Issue
            </button>
          </div>
        `;
      } else {
        content = `
          <button class="modal-close" onclick="closeModal()">√ó</button>
          <h2 class="modal-title">‚è≥ Pending</h2>
          <p class="modal-subtitle">Waiting for ${sender.chimeSign} to send the Boost</p>

          <div class="card">
            <div class="flex-between">
              <span class="text-secondary">Status:</span>
              <span class="badge badge-yellow">Pending</span>
            </div>
          </div>

          <button class="btn btn-secondary btn-block mt-24" onclick="closeModal()">Close</button>
        `;
      }

      showModal(content);
    }

    function confirmSendBoost(groupId, senderId, receiverId) {
      const groups = getAllGroups();
      const group = groups[groupId];
      if (!group) return;

      const currentMonth = getCurrentMonthKey();
      const assignments = group.monthlyAssignments[currentMonth];
      const assignment = assignments.find(a => a.senderId === senderId && a.receiverId === receiverId);
      
      if (!assignment) return;

      assignment.senderConfirmedAt = Date.now();
      assignment.status = BOOST_STATES.SENDER_CONFIRMED;
      saveGroup(group);

      notifications.create({
        userId: receiverId,
        type: 'info',
        message: `${getUser(senderId).chimeSign} says they sent you a boost. Please confirm!`,
        severity: 'info'
      });

      closeModal();
      showConfetti();
      render();
    }

    function confirmReceiveBoost(groupId, senderId, receiverId) {
      const groups = getAllGroups();
      const group = groups[groupId];
      if (!group) return;

      const currentMonth = getCurrentMonthKey();
      const assignments = group.monthlyAssignments[currentMonth];
      const assignment = assignments.find(a => a.senderId === senderId && a.receiverId === receiverId);
      
      if (!assignment) return;

      assignment.receiverConfirmedAt = Date.now();
      assignment.status = BOOST_STATES.CONFIRMED;
      saveGroup(group);

      updateReputation(senderId, 2);
      updateReputation(receiverId, 2);

      notifications.create({
        userId: senderId,
        type: 'boost_confirmed',
        message: `${getUser(receiverId).chimeSign} confirmed your boost! +2 reputation`,
        severity: 'success'
      });

      closeModal();
      showConfetti();
      
      showModal(`
        <h2 class="modal-title">‚úÖ Boost Confirmed!</h2>
        <p class="modal-subtitle">You both earned +2 reputation points</p>
        <button class="btn btn-primary btn-block" onclick="closeModal(); render();">Done</button>
      `);
    }

    function showFailureReasons(groupId, senderId, receiverId) {
      showModal(`
        <button class="modal-close" onclick="closeModal()">√ó</button>
        <h2 class="modal-title">Why can't you send?</h2>
        <p class="modal-subtitle">This helps us understand what went wrong</p>
        
        <div class="form-group">
          <div class="radio-option" style="display: block; margin-bottom: 12px;">
            <input type="radio" name="failReason" value="no_boosts_left" id="reason1">
            <label for="reason1" style="margin-left: 8px;">I used all my boosts already</label>
          </div>
          <div class="radio-option" style="display: block; margin-bottom: 12px;">
            <input type="radio" name="failReason" value="outstanding_balance" id="reason2">
            <label for="reason2" style="margin-left: 8px;">I have an outstanding SpotMe balance</label>
          </div>
          <div class="radio-option" style="display: block; margin-bottom: 12px;">
            <input type="radio" name="failReason" value="wrong_chime_sign" id="reason3">
            <label for="reason3" style="margin-left: 8px;">Can't find their Chime sign in my app</label>
          </div>
          <div class="radio-option" style="display: block; margin-bottom: 12px;">
            <input type="radio" name="failReason" value="other" id="reason4">
            <label for="reason4" style="margin-left: 8px;">Other reason</label>
          </div>
        </div>

        <button class="btn btn-primary btn-block" onclick="submitFailure('${groupId}', '${senderId}', '${receiverId}')">
          Submit
        </button>
      `);
    }

    function submitFailure(groupId, senderId, receiverId) {
      const reason = document.querySelector('input[name="failReason"]:checked')?.value;
      if (!reason) {
        alert('Please select a reason');
        return;
      }

      const groups = getAllGroups();
      const group = groups[groupId];
      const currentMonth = getCurrentMonthKey();
      const assignment = group.monthlyAssignments[currentMonth]
        .find(a => a.senderId === senderId && a.receiverId === receiverId);
      
      assignment.status = BOOST_STATES.FAILED;
      assignment.failedAt = Date.now();
      assignment.failureReason = reason;
      saveGroup(group);

      updateReputation(senderId, -3);

      notifications.create({
        userId: senderId,
        type: 'warning',
        message: `Boost marked as failed. -3 reputation. Try to complete commitments next time.`,
        severity: 'warning'
      });

      notifications.create({
        userId: receiverId,
        type: 'info',
        message: `${getUser(senderId).chimeSign} couldn't send your boost this month.`,
        severity: 'info'
      });

      closeModal();
      render();
    }

    function reportIssue(groupId, senderId, receiverId) {
      showModal(`
        <button class="modal-close" onclick="closeModal()">√ó</button>
        <h2 class="modal-title">Report Issue</h2>
        <p class="modal-subtitle">Help us understand what went wrong</p>

        <div class="form-group">
          <label class="form-label">Issue Type</label>
          <select class="form-select form-input" id="issueType">
            <option value="not_received">Never received Boost</option>
            <option value="wrong_person">Wrong person sent to me</option>
            <option value="other">Other</option>
          </select>
        </div>

        <div class="form-group">
          <label class="form-label">Additional Details (optional)</label>
          <textarea class="form-input" id="issueDetails" rows="3"></textarea>

    </div>

    <div style="display: flex; gap: 16px;">
      <button class="btn btn-secondary btn-block" onclick="closeModal()">Cancel</button>
      <button class="btn btn-danger btn-block" onclick="submitIssueReport('${groupId}', '${senderId}', '${receiverId}')">
        Submit Report
      </button>
    </div>
  `);
}

function submitIssueReport(groupId, senderId, receiverId) {
  const issueType = document.getElementById('issueType').value;
  const issueDetails = document.getElementById('issueDetails').value.trim();

  const disputes = getFromStorage(STORAGE_KEYS.DISPUTES) || {};
  const disputeId = generateId();

  disputes[disputeId] = {
    id: disputeId,
    groupId,
    reporterId: getSession().userId,
    subjectId: senderId,
    reason: issueType,
    details: issueDetails,
    status: 'open',
    createdAt: Date.now(),
    resolvedAt: null
  };

  saveToStorage(STORAGE_KEYS.DISPUTES, disputes);

  notifications.create({
    userId: getGroup(groupId).creatorId,
    type: 'warning',
    message: `Dispute reported in ${getGroup(groupId).name}`,
    severity: 'warning'
  });

  closeModal();
  
  showModal(`
    <h2 class="modal-title">Report Submitted</h2>
    <p class="modal-subtitle">The group admin will review this issue</p>
    <button class="btn btn-primary btn-block" onclick="closeModal(); render();">Done</button>
  `);
}

// ============================================
// GROUP MANAGEMENT
// ============================================

function showCreateGroup() {
  showModal(`
    <button class="modal-close" onclick="closeModal()">√ó</button>
    <h2 class="modal-title">Create a Group</h2>
    <p class="modal-subtitle">Start coordinating Boosts with friends</p>

    <div class="form-group">
      <label class="form-label">Group Name</label>
      <input type="text" class="form-input" id="groupName" placeholder="Weekend Warriors">
      <div class="form-error hidden" id="groupNameError"></div>
    </div>

    <div class="form-group">
      <label class="form-label">Max Members</label>
      <select class="form-input" id="maxMembers">
        <option value="4">4 members</option>
        <option value="5">5 members</option>
        <option value="6">6 members</option>
        <option value="7">7 members</option>
        <option value="8" selected>8 members</option>
        <option value="9">9 members</option>
        <option value="10">10 members</option>
      </select>
    </div>

    <button class="btn btn-primary btn-block" onclick="createGroup()">Create Group</button>
  `);
}

function createGroup() {
  const session = getSession();
  if (!session) return;

  const name = document.getElementById('groupName').value.trim();
  const maxMembers = parseInt(document.getElementById('maxMembers').value);

  if (name.length < 3 || name.length > 30) {
    document.getElementById('groupNameError').textContent = 'Name must be 3-30 characters';
    document.getElementById('groupNameError').classList.remove('hidden');
    return;
  }

  const inviteCode = generateInviteCode();
  
  const group = {
    id: generateId(),
    name,
    creatorId: session.userId,
    inviteCode,
    maxMembers,
    memberIds: [session.userId],
    createdAt: Date.now(),
    monthlyAssignments: {},
    kickHistory: []
  };

  saveGroup(group);

  const users = getAllUsers();
  const user = users[session.userId];
  user.groupIds = user.groupIds || [];
  user.groupIds.push(group.id);
  saveUser(user);

  closeModal();
  showInviteCode(group.id);
  render();
}

function generateInviteCode() {
  const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
  let code = '';
  for (let i = 0; i < 6; i++) {
    code += chars[Math.floor(Math.random() * chars.length)];
  }
  return code;
}

function showInviteCode(groupId) {
  const group = getGroup(groupId);
  if (!group) return;

  showModal(`
    <button class="modal-close" onclick="closeModal()">√ó</button>
    <h2 class="modal-title">Invite Members</h2>
    <p class="modal-subtitle">Share this code with friends to join ${group.name}</p>

    <div style="background: var(--bg-tertiary); padding: 24px; border-radius: 12px; text-align: center; margin: 24px 0;">
      <div class="text-secondary" style="font-size: 12px; margin-bottom: 8px;">Invite Code</div>
      <div style="font-size: 42px; font-weight: 800; letter-spacing: 8px; color: var(--accent-blue); font-family: 'JetBrains Mono', monospace; margin: 12px 0;">
        ${group.inviteCode}
      </div>
      <div style="color: var(--text-muted); font-size: 11px; word-break: break-all; margin-top: 12px;">
        boostcircle.app/join/${group.inviteCode}
      </div>
    </div>

    <button class="btn btn-primary btn-block" onclick="closeModal()">Done</button>
  `);
}

function showJoinGroup() {
  showModal(`
    <button class="modal-close" onclick="closeModal()">√ó</button>
    <h2 class="modal-title">Join a Group</h2>
    <p class="modal-subtitle">Enter the invite code you received</p>

    <div class="form-group">
      <label class="form-label">Invite Code</label>
      <input type="text" class="form-input" id="inviteCode" placeholder="ABC123" style="text-transform: uppercase; font-family: 'JetBrains Mono', monospace; font-size: 18px; text-align: center; letter-spacing: 4px;">
      <div class="form-error hidden" id="inviteCodeError"></div>
    </div>

    <div id="groupPreview"></div>

    <button class="btn btn-primary btn-block" onclick="joinGroup()">Join Group</button>
  `);

  document.getElementById('inviteCode').addEventListener('input', (e) => {
    e.target.value = e.target.value.toUpperCase();
    if (e.target.value.length === 6) {
      previewGroup(e.target.value);
    } else {
      document.getElementById('groupPreview').innerHTML = '';
    }
  });
}

function previewGroup(code) {
  const groups = getAllGroups();
  const group = Object.values(groups).find(g => g.inviteCode === code);
  
  if (!group) {
    document.getElementById('inviteCodeError').textContent = 'Invalid invite code';
    document.getElementById('inviteCodeError').classList.remove('hidden');
    document.getElementById('groupPreview').innerHTML = '';
    return;
  }

  document.getElementById('inviteCodeError').classList.add('hidden');

  const users = getAllUsers();
  const members = group.memberIds.map(id => users[id]).filter(Boolean);
  const avgRep = Math.round(members.reduce((sum, m) => sum + m.reputation, 0) / members.length);

  document.getElementById('groupPreview').innerHTML = `
    <div class="card" style="margin-top: 20px; padding: 20px;">
      <h3 style="font-size: 17px; font-weight: 700; margin-bottom: 8px;">${group.name}</h3>
      <div class="text-secondary" style="font-size: 13px;">
        ${members.length} / ${group.maxMembers} members ‚Ä¢ Avg Rep: ${avgRep}
      </div>
    </div>
  `;
}

function joinGroup() {
  const session = getSession();
  if (!session) return;

  const code = document.getElementById('inviteCode').value.trim().toUpperCase();
  
  const groups = getAllGroups();
  const group = Object.values(groups).find(g => g.inviteCode === code);

  if (!group) {
    document.getElementById('inviteCodeError').textContent = 'Invalid invite code';
    document.getElementById('inviteCodeError').classList.remove('hidden');
    return;
  }

  if (group.memberIds.includes(session.userId)) {
    document.getElementById('inviteCodeError').textContent = 'You\'re already in this group';
    document.getElementById('inviteCodeError').classList.remove('hidden');
    return;
  }

  if (group.memberIds.length >= group.maxMembers) {
    document.getElementById('inviteCodeError').textContent = 'This group is full';
    document.getElementById('inviteCodeError').classList.remove('hidden');
    return;
  }

  group.memberIds.push(session.userId);
  saveGroup(group);

  const users = getAllUsers();
  const user = users[session.userId];
  user.groupIds = user.groupIds || [];
  user.groupIds.push(group.id);
  saveUser(user);

  notifications.create({
    userId: group.creatorId,
    type: 'success',
    message: `${user.fullName} joined ${group.name}!`,
    severity: 'success'
  });

  closeModal();
  render();
}

function confirmLeaveGroup(groupId) {
  showModal(`
    <button class="modal-close" onclick="closeModal()">√ó</button>
    <h2 class="modal-title">Leave Group</h2>
    <p class="modal-subtitle">Are you sure you want to leave? This will affect your reputation if done mid-month.</p>

    <div class="alert alert-warning">
      ‚ö†Ô∏è Leaving mid-month may result in a reputation penalty
    </div>

    <div style="display: flex; gap: 16px; margin-top: 24px;">
      <button class="btn btn-secondary btn-block" onclick="closeModal()">Cancel</button>
      <button class="btn btn-danger btn-block" onclick="leaveGroup('${groupId}')">Leave Group</button>
    </div>
  `);
}

function leaveGroup(groupId) {
  const session = getSession();
  if (!session) return;

  const groups = getAllGroups();
  const group = groups[groupId];
  if (!group) return;

  group.memberIds = group.memberIds.filter(id => id !== session.userId);
  saveGroup(group);

  const users = getAllUsers();
  const user = users[session.userId];
  user.groupIds = user.groupIds.filter(id => id !== groupId);
  
  const now = new Date();
  if (now.getDate() < 25) {
    updateReputation(session.userId, -15);
    notifications.create({
      userId: session.userId,
      type: 'warning',
      message: `You left ${group.name} mid-month. -15 reputation penalty.`,
      severity: 'warning'
    });
  }
  
  saveUser(user);

  closeModal();
  render();
}

function showMemberManagement(groupId, memberId) {
  const user = getUser(memberId);
  const group = getGroup(groupId);
  
  if (!group || !user) return;

  const currentMonth = getCurrentMonthKey();
  const assignments = group.monthlyAssignments[currentMonth] || [];
  const memberSends = assignments.filter(a => a.senderId === memberId);
  const confirmed = memberSends.filter(a => a.status === BOOST_STATES.CONFIRMED).length;

  showModal(`
    <button class="modal-close" onclick="closeModal()">√ó</button>
    <h2 class="modal-title">Manage Member</h2>
    
    <div class="card">
      <div class="flex-between mb-8">
        <span>Name:</span>
        <span>${user.fullName}</span>
      </div>
      <div class="flex-between mb-8">
        <span>Chime Sign:</span>
        <span class="commitment-sign">${user.chimeSign}</span>
      </div>
      <div class="flex-between mb-8">
        <span>Reputation:</span>
        <span class="badge badge-${getReputationLevel(user.reputation).badge}">${user.reputation}</span>
      </div>
      <div class="flex-between mb-8">
        <span>Strikes:</span>
        <span>${user.strikes?.count || 0}/${AUTO_KICK_RULES.STRIKES_LIMIT}</span>
      </div>
      <div class="flex-between">
        <span>This Month:</span>
        <span>${confirmed}/${memberSends.length} completed</span>
      </div>
    </div>
    
    ${user.reputation < 50 ? `
      <div class="alert alert-warning mt-16">
        ‚ö†Ô∏è This member has low reputation and may be unreliable.
      </div>
    ` : ''}
    
    <button class="btn btn-danger btn-block mt-24" onclick="confirmKickMember('${groupId}', '${memberId}')">
      Remove from Group
    </button>
  `);
}

function confirmKickMember(groupId, memberId) {
  showModal(`
    <button class="modal-close" onclick="closeModal()">√ó</button>
    <h2 class="modal-title">Remove Member?</h2>
    <p class="modal-subtitle">This will remove ${getUser(memberId).fullName} from the group immediately.</p>
    
    <div class="form-group">
      <label class="form-label">Reason (optional)</label>
      <textarea class="form-input" id="kickReason" placeholder="Not following through on commitments..."></textarea>
    </div>
    
    <div style="display: flex; gap: 16px;">
      <button class="btn btn-secondary btn-block" onclick="closeModal()">Cancel</button>
      <button class="btn btn-danger btn-block" onclick="performKick('${groupId}', '${memberId}')">Remove</button>
    </div>
  `);
}

function performKick(groupId, memberId) {
  const reason = document.getElementById('kickReason').value.trim();
  const session = getSession();
  
  removeUserFromGroup(groupId, memberId, 'admin_kick', reason, session.userId);
  
  notifications.create({
    userId: memberId,
    type: 'removed_from_group',
    message: `You've been removed from ${getGroup(groupId).name}. Reason: ${reason || 'Admin decision'}`,
    severity: 'error'
  });

  closeModal();
  showGroupDetail(groupId);
}

// ============================================
// NOTIFICATIONS
// ============================================

function showNotifications() {
  const session = getSession();
  if (!session) return;

  const userNotifs = notifications.getForUser(session.userId)
    .sort((a, b) => b.createdAt - a.createdAt)
    .slice(0, 20);

  if (userNotifs.length === 0) {
    showModal(`
      <button class="modal-close" onclick="closeModal()">√ó</button>
      <h2 class="modal-title">Notifications</h2>
      <p class="text-secondary text-center" style="padding: 40px 0;">No notifications yet</p>
    `);
    return;
  }

  showModal(`
    <button class="modal-close" onclick="closeModal()">√ó</button>
    <h2 class="modal-title">Notifications</h2>
    <button class="btn btn-secondary btn-block mb-16" onclick="notifications.markAllRead('${session.userId}'); showNotifications();">
      Mark All Read
    </button>
    
    <div style="max-height: 400px; overflow-y: auto;">
      ${userNotifs.map(n => {
        const timeSince = getTimeSince(n.createdAt);
        return `
          <div class="card" style="margin-bottom: 12px; padding: 16px; ${n.read ? 'opacity: 0.6;' : ''}">
            <div style="display: flex; gap: 12px; align-items: flex-start;">
              <div style="font-size: 24px;">${notifications.getIcon(n.type)}</div>
              <div style="flex: 1;">
                <div style="font-weight: 600; font-size: 13px; margin-bottom: 4px;">
                  ${notifications.getTitle(n.type)}
                </div>
                <div style="font-size: 13px; color: var(--text-secondary);">
                  ${n.message}
                </div>
                <div style="font-size: 11px; color: var(--text-muted); margin-top: 4px;">
                  ${timeSince}
                </div>
              </div>
            </div>
          </div>
        `;
      }).join('')}
    </div>
  `);
}

function getTimeSince(timestamp) {
  const seconds = Math.floor((Date.now() - timestamp) / 1000);
  
  if (seconds < 60) return 'Just now';
  const minutes = Math.floor(seconds / 60);
  if (minutes < 60) return `${minutes}m ago`;
  const hours = Math.floor(minutes / 60);
  if (hours < 24) return `${hours}h ago`;
  const days = Math.floor(hours / 24);
  return `${days}d ago`;
}

// ============================================
// MODAL SYSTEM
// ============================================

function showModal(content) {
  const overlay = document.getElementById('modalOverlay');
  const modalContent = document.getElementById('modalContent');
  modalContent.innerHTML = content;
  overlay.classList.add('active');
}

function closeModal() {
  const overlay = document.getElementById('modalOverlay');
  overlay.classList.remove('active');
  modalState = {};
}

document.getElementById('modalOverlay').addEventListener('click', (e) => {
  if (e.target.id === 'modalOverlay') {
    closeModal();
  }
});

document.addEventListener('keydown', (e) => {
  if (e.key === 'Escape') {
    closeModal();
  }
});

// ============================================
// SIGNUP FLOW
// ============================================

function showSignup() {
  modalState = {
    step: 1,
    data: {}
  };
  renderSignupStep();
}

function renderSignupStep() {
  const step = modalState.step;
  const data = modalState.data;

  const steps = [
    { title: 'Create Account', subtitle: 'Let\'s get started' },
    { title: 'Age Verification', subtitle: 'Must be 18 or older' },
    { title: 'Chime Identity', subtitle: 'How others find you' },
    { title: 'Boost Availability', subtitle: 'Your monthly capacity' },
    { title: 'Agreement', subtitle: 'Final step' }
  ];

  const currentStep = steps[step - 1];
  let stepContent = '';

  if (step === 1) {
    stepContent = `
      <div class="form-group">
        <label class="form-label">Full Name</label>
        <input type="text" class="form-input" id="fullName" value="${data.fullName || ''}" placeholder="John Doe">
        <div class="form-error hidden" id="fullNameError"></div>
      </div>
      <div class="form-group">
        <label class="form-label">Email</label>
        <input type="email" class="form-input" id="email" value="${data.email || ''}" placeholder="john@example.com">
        <div class="form-error hidden" id="emailError"></div>
      </div>
      <div class="form-group">
        <label class="form-label">Password</label>
        <input type="password" class="form-input" id="password" value="${data.password || ''}" placeholder="Min 8 characters">
        <div class="password-strength" id="passwordStrength">
          <div class="strength-bar"></div>
          <div class="strength-bar"></div>
          <div class="strength-bar"></div>
          <div class="strength-bar"></div>
        </div>
        <div class="form-error hidden" id="passwordError"></div>
      </div>
    `;
  } else if (step === 2) {
    stepContent = `
      <div class="form-group">
        <label class="form-label">Birthday</label>
        <input type="date" class="form-input" id="birthday" value="${data.birthday || ''}" max="${new Date().toISOString().split('T')[0]}">
        <div class="form-help">You must be 18 or older to use BoostCircle</div>
        <div class="form-error hidden" id="birthdayError"></div>
      </div>
    `;
  } else if (step === 3) {
    stepContent = `
      <div class="form-group">
        <label class="form-label">Chime Sign</label>
        <input type="text" class="form-input" id="chimeSign" value="${data.chimeSign || ''}" placeholder="$YourHandle" style="font-family: 'JetBrains Mono', monospace;">
        <div class="form-help">Format: $Username (3-15 characters, no spaces)</div>
        <div class="form-error hidden" id="chimeSignError"></div>
      </div>
    `;
  } else if (step === 4) {
    stepContent = `
      <div class="form-group">
        <label class="form-label">Chime Eligibility Status</label>
        <div class="radio-option" style="display: block; margin-bottom: 12px; cursor: pointer;" onclick="document.getElementById('tier1').checked = true;">
          <input type="radio" name="eligibility" value="FULL_MEMBER" id="tier1" ${data.chimeEligibility === 'FULL_MEMBER' ? 'checked' : ''}>
          <div style="margin-left: 28px; margin-top: -20px;">
            <div style="font-weight: 600;">Full Member (4 boosts/month)</div>
            <div style="font-size: 12px; color: var(--text-secondary); margin-top: 2px;">
              Active Chime card + $200+ direct deposit monthly
            </div>
          </div>
        </div>
        <div class="radio-option" style="display: block; margin-bottom: 12px; cursor: pointer;" onclick="document.getElementById('tier2').checked = true;">
          <input type="radio" name="eligibility" value="LIMITED_MEMBER" id="tier2" ${data.chimeEligibility === 'LIMITED_MEMBER' ? 'checked' : ''}>
          <div style="margin-left: 28px; margin-top: -20px;">
            <div style="font-weight: 600;">Limited Member (1 boost/month)</div>
            <div style="font-size: 12px; color: var(--text-secondary); margin-top: 2px;">
              Active Chime card, no direct deposit
            </div>
          </div>
        </div>
      </div>
    `;
  } else if (step === 5) {
    stepContent = `
      <div class="checkbox-group">
        <input type="checkbox" id="agree1" ${data.agree1 ? 'checked' : ''}>
        <label for="agree1">I agree to honor my monthly Boost commitments</label>
      </div>
      <div class="checkbox-group">
        <input type="checkbox" id="agree2" ${data.agree2 ? 'checked' : ''}>
        <label for="agree2">I understand this app does not move real money</label>
      </div>
      <div class="checkbox-group">
        <input type="checkbox" id="agree3" ${data.agree3 ? 'checked' : ''}>
        <label for="agree3">I understand BoostCircle is not affiliated with Chime</label>
      </div>
    `;
  }

  showModal(`
    <button class="modal-close" onclick="closeModal()">√ó</button>
    <h2 class="modal-title">${currentStep.title}</h2>
    <p class="modal-subtitle">${currentStep.subtitle}</p>
    
    <div class="modal-steps">
      ${steps.map((_, i) => `<div class="modal-step ${i < step - 1 ? 'completed' : i === step - 1 ? 'active' : ''}"></div>`).join('')}
    </div>

    ${stepContent}

    <div class="flex gap-16" style="margin-top: 28px;">
      ${step > 1 ? '<button class="btn btn-secondary" onclick="signupPrevStep()">Back</button>' : ''}
      <button class="btn btn-primary btn-block" onclick="signupNextStep()" id="signupNextBtn">
        ${step === 5 ? 'Create Account' : 'Continue'}
      </button>
    </div>

    ${step === 1 ? `
      <div style="text-align: center; margin-top: 20px;">
        <span class="text-secondary" style="font-size: 13px;">Already have an account?</span>
        <a onclick="showLogin()" style="color: var(--accent-blue); cursor: pointer; margin-left: 4px; font-weight: 600;">Login</a>
      </div>
    ` : ''}
  `);

  if (step === 1) {
    document.getElementById('password').addEventListener('input', (e) => {
      const strength = calculatePasswordStrength(e.target.value);
      const bars = document.querySelectorAll('.strength-bar');
      bars.forEach((bar, i) => {
        bar.classList.remove('active', 'weak', 'medium');
        if (i < strength) {
          bar.classList.add('active');
          if (strength <= 2) bar.classList.add('weak');
          else if (strength === 3) bar.classList.add('medium');
        }
      });
    });
  }

  if (step === 5) {
    const updateButton = () => {
      const agree1 = document.getElementById('agree1').checked;
      const agree2 = document.getElementById('agree2').checked;
      const agree3 = document.getElementById('agree3').checked;
      document.getElementById('signupNextBtn').disabled = !(agree1 && agree2 && agree3);
    };
    document.getElementById('agree1').addEventListener('change', updateButton);
    document.getElementById('agree2').addEventListener('change', updateButton);
    document.getElementById('agree3').addEventListener('change', updateButton);
    updateButton();
  }
}

function signupNextStep() {
  const step = modalState.step;
  const data = modalState.data;

  if (step === 1) {
    const fullName = document.getElementById('fullName').value.trim();
    const email = document.getElementById('email').value.trim();
    const password = document.getElementById('password').value;

    let hasError = false;

    if (fullName.length < 2 || fullName.length > 50) {
      document.getElementById('fullNameError').textContent = 'Name must be 2-50 characters';
      document.getElementById('fullNameError').classList.remove('hidden');
      hasError = true;
    } else {
      document.getElementById('fullNameError').classList.add('hidden');
    }

    if (!validateEmail(email)) {
      document.getElementById('emailError').textContent = 'Please enter a valid email';
      document.getElementById('emailError').classList.remove('hidden');
      hasError = true;
    } else {
      const users = getAllUsers();
      const emailExists = Object.values(users).some(u => u.email === email);
      if (emailExists) {
        document.getElementById('emailError').textContent = 'Email already registered';
        document.getElementById('emailError').classList.remove('hidden');
        hasError = true;
      } else {
        document.getElementById('emailError').classList.add('hidden');
      }
    }

    if (password.length < 8) {
      document.getElementById('passwordError').textContent = 'Password must be at least 8 characters';
      document.getElementById('passwordError').classList.remove('hidden');
      hasError = true;
    } else {
      document.getElementById('passwordError').classList.add('hidden');
    }

    if (hasError) return;

    data.fullName = fullName;
    data.email = email;
    data.password = password;
  }

  if (step === 2) {
    const birthday = document.getElementById('birthday').value;
    
    if (!birthday) {
      document.getElementById('birthdayError').textContent = 'Please enter your birthday';
      document.getElementById('birthdayError').classList.remove('hidden');
      return;
    }

    const age = calculateAge(birthday);
    if (age < 18) {
      document.getElementById('birthdayError').textContent = 'You must be 18 or older to use BoostCircle';
      document.getElementById('birthdayError').classList.remove('hidden');
      return;
    }

    document.getElementById('birthdayError').classList.add('hidden');
    data.birthday = birthday;
  }

  if (step === 3) {
    const chimeSign = document.getElementById('chimeSign').value.trim();
    
    if (!validateChimeSign(chimeSign)) {
      document.getElementById('chimeSignError').textContent = 'Format: $Username (3-15 alphanumeric characters)';
      document.getElementById('chimeSignError').classList.remove('hidden');
      return;
    }

    const users = getAllUsers();
    const signExists = Object.values(users).some(u => u.chimeSign.toLowerCase() === chimeSign.toLowerCase());
    if (signExists) {
      document.getElementById('chimeSignError').textContent = 'This Chime Sign is already taken';
      document.getElementById('chimeSignError').classList.remove('hidden');
      return;
    }

    document.getElementById('chimeSignError').classList.add('hidden');
    data.chimeSign = chimeSign;
  }

  if (step === 4) {
    const eligibility = document.querySelector('input[name="eligibility"]:checked')?.value || 'FULL_MEMBER';
    data.chimeEligibility = eligibility;
  }

  if (step === 5) {
    const agree1 = document.getElementById('agree1').checked;
    const agree2 = document.getElementById('agree2').checked;
    const agree3 = document.getElementById('agree3').checked;

    if (!agree1 || !agree2 || !agree3) return;

    data.agree1 = agree1;
    data.agree2 = agree2;
    data.agree3 = agree3;

    completeSignup(data);
    return;
  }

  modalState.step++;
  renderSignupStep();
}

function signupPrevStep() {
  modalState.step--;
  renderSignupStep();
}

async function completeSignup(data) {
  showLoading('Creating your account...');
  
  try {
    const passwordHash = await hashPassword(data.password);
    
    const user = {
      id: generateId(),
      fullName: data.fullName,
      email: data.email,
      passwordHash,
      birthday: data.birthday,
      chimeSign: data.chimeSign,
      chimeEligibility: data.chimeEligibility,
      reputation: 50,
      groupIds: [],
      strikes: { count: 0, history: [], lastStrikeAt: null },
      joinedAt: Date.now(),
      lastLogin: Date.now()
    };

    saveUser(user);
    saveSession(user.id, false);

    hideLoading();
    closeModal();
    
    notifications.create({
      userId: user.id,
      type: 'success',
      message: 'Welcome to BoostCircle! Start by creating or joining a group.',
      severity: 'success'
    });

    render();
  } catch (error) {
    hideLoading();
    alert('Error creating account. Please try again.');
  }
}

// ============================================
// LOGIN FLOW
// ============================================

function showLogin() {
  showModal(`
    <button class="modal-close" onclick="closeModal()">√ó</button>
    <h2 class="modal-title">Welcome Back</h2>
    <p class="modal-subtitle">Login to your account</p>

    <div class="form-group">
      <label class="form-label">Email</label>
      <input type="email" class="form-input" id="loginEmail" placeholder="john@example.com">
      <div class="form-error hidden" id="loginEmailError"></div>
    </div>

    <div class="form-group">
      <label class="form-label">Password</label>
      <input type="password" class="form-input" id="loginPassword" placeholder="Enter your password">
      <div class="form-error hidden" id="loginPasswordError"></div>
    </div>

    <div class="checkbox-group">
      <input type="checkbox" id="rememberMe">
      <label for="rememberMe">Remember me for 90 days</label>
    </div>

    <button class="btn btn-primary btn-block" onclick="performLogin()">Login</button>

    <div style="text-align: center; margin-top: 20px;">
      <span class="text-secondary" style="font-size: 13px;">Don't have an account?</span>
      <a onclick="showSignup()" style="color: var(--accent-blue); cursor: pointer; margin-left: 4px; font-weight: 600;">Sign Up</a>
    </div>
  `);

  document.getElementById('loginPassword').addEventListener('keypress', (e) => {
    if (e.key === 'Enter') performLogin();
  });
}

async function performLogin() {
  showLoading('Logging in...');
  
  try {
    const email = document.getElementById('loginEmail').value.trim();
    const password = document.getElementById('loginPassword').value;
    const rememberMe = document.getElementById('rememberMe').checked;

    if (!email || !password) {
      hideLoading();
      document.getElementById('loginEmailError').textContent = 'Please fill in all fields';
      document.getElementById('loginEmailError').classList.remove('hidden');
      return;
    }

    const users = getAllUsers();
    const user = Object.values(users).find(u => u.email === email);

    if (!user) {
      hideLoading();
      document.getElementById('loginEmailError').textContent = 'Account not found';
      document.getElementById('loginEmailError').classList.remove('hidden');
      return;
    }

    const passwordHash = await hashPassword(password);
    if (passwordHash !== user.passwordHash) {
      hideLoading();
      document.getElementById('loginPasswordError').textContent = 'Incorrect password';
      document.getElementById('loginPasswordError').classList.remove('hidden');
      return;
    }

    user.lastLogin = Date.now();
    saveUser(user);
    saveSession(user.id, rememberMe);

    hideLoading();
    closeModal();
    render();
  } catch (error) {
    hideLoading();
    alert('Error logging in. Please try again.');
  }
}

// ============================================
// USER MENU
// ============================================

function showUserMenu() {
  const session = getSession();
  if (!session) return;

  const users = getAllUsers();
  const user = users[session.userId];
  const eligibility = ELIGIBILITY_TIERS[user.chimeEligibility];

  showModal(`
    <button class="modal-close" onclick="closeModal()">√ó</button>
    <h2 class="modal-title">Account</h2>
    
    <div class="card">
      <div class="flex-between mb-8">
        <span class="text-secondary">Name:</span>
        <span>${user.fullName}</span>
      </div>
      <div class="flex-between mb-8">
        <span class="text-secondary">Email:</span>
        <span>${user.email}</span>
      </div>
      <div class="flex-between mb-8">
        <span class="text-secondary">Chime Sign:</span>
        <span class="commitment-sign">${user.chimeSign}</span>
      </div>
      <div class="flex-between mb-8">
        <span class="text-secondary">Eligibility:</span>
        <span>${eligibility.label}</span>
      </div>
      <div class="flex-between">
        <span class="text-secondary">Boosts per Month:</span>
        <span>${eligibility.canSend}</span>
      </div>
    </div>

    <button class="btn btn-danger btn-block mt-24" onclick="logout()">Logout</button>
  `);
}

function logout() {
  clearSession();
  closeModal();
  render();
}

// ============================================
// UTILITY FUNCTIONS
// ============================================

function showConfetti() {
  const colors = ['#10b981', '#2563eb', '#f59e0b', '#ef4444', '#8b5cf6'];
  for (let i = 0; i < 50; i++) {
    setTimeout(() => {
      const confetti = document.createElement('div');
      confetti.className = 'confetti';
      confetti.style.left = Math.random() * 100 + '%';
      confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
      confetti.style.animationDuration = (2 + Math.random()) + 's';
      document.body.appendChild(confetti);
      setTimeout(() => confetti.remove(), 3000);
    }, i * 30);
  }
}

function showFAQ() {
  showModal(`
    <button class="modal-close" onclick="closeModal()">√ó</button>
    <h2 class="modal-title">Frequently Asked Questions</h2>
    
    <div class="card" style="margin-bottom: 12px;">
      <div style="font-weight: 600; margin-bottom: 8px;">How does BoostCircle work?</div>
      <div class="text-secondary" style="font-size: 14px;">
        BoostCircle coordinates monthly Boost exchanges. You join a group, get assigned who to send to, confirm when done. Everyone gets fair distribution.
      </div>
    </div>

    <div class="card" style="margin-bottom: 12px;">
      <div style="font-weight: 600; margin-bottom: 8px;">Does BoostCircle send boosts for me?</div>
      <div class="text-secondary" style="font-size: 14px;">
        No! BoostCircle only coordinates. You must send boosts through the official Chime app. We never access your account.
      </div>
    </div>

    <div class="card" style="margin-bottom: 12px;">
      <div style="font-weight: 600; margin-bottom: 8px;">What if someone doesn't send?</div>
      <div class="text-secondary" style="font-size: 14px;">
        Their reputation drops and they may be auto-removed after 2 strikes. The system protects reliable members.
      </div>
    </div>

    <button class="btn btn-primary btn-block mt-24" onclick="closeModal()">Got it</button>
  `);
}

function showSupport() {
  showModal(`
    <button class="modal-close" onclick="closeModal()">√ó</button>
    <h2 class="modal-title">Report Issues</h2>
    <p class="modal-subtitle">Need help? Contact us</p>
    
    <div class="card">
      <p style="margin-bottom: 12px;">Email: support@boostcircle.app</p>
      <p>We typically respond within 24 hours</p>
    </div>

    <button class="btn btn-primary btn-block mt-24" onclick="closeModal()">Close</button>
  `);
}

function showPrivacy() {
  showModal(`
    <button class="modal-close" onclick="closeModal()">√ó</button>
    <h2 class="modal-title">Privacy Policy</h2>
    
    <div class="card" style="max-height: 400px; overflow-y: auto;">
      <p style="margin-bottom: 16px;"><strong>Data We Store:</strong></p>
      <ul style="padding-left: 20px; color: var(--text-secondary); line-height: 1.8; margin-bottom: 16px;">
        <li>Your name, email, and Chime sign</li>
        <li>Group memberships and boost commitments</li>
        <li>Reputation scores and activity history</li>
      </ul>
      
      <p style="margin-bottom: 16px;"><strong>Data We DON'T Store:</strong></p>
      <ul style="padding-left: 20px; color: var(--text-secondary); line-height: 1.8;">
        <li>Banking credentials or Chime login</li>
        <li>Financial information or account balances</li>
        <li>Personal messages or private data</li>
      </ul>
    </div>

    <button class="btn btn-primary btn-block mt-24" onclick="closeModal()">Close</button>
  `);
}

// ============================================
// INITIALIZATION
// ============================================

window.onload = () => {
  render();
  
  // Schedule reminders check (daily)
  setInterval(scheduleReminders, 24 * 60 * 60 * 1000);
  
  // Check expired boosts (hourly)
  setInterval(checkExpiredBoosts, 60 * 60 * 1000);
  
  debugLog('BoostCircle v2.0 initialized');
};

  </script>
</body>
</html>
